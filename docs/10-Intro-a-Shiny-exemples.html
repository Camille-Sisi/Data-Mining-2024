<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 10 La création d’une application Shiny “pas à pas” avec l’une de nos bases de données | DATA MINING</title>
  <meta name="description" content="Titre du cours" />
  <meta name="generator" content="bookdown 0.38 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 10 La création d’une application Shiny “pas à pas” avec l’une de nos bases de données | DATA MINING" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Titre du cours" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 10 La création d’une application Shiny “pas à pas” avec l’une de nos bases de données | DATA MINING" />
  
  <meta name="twitter:description" content="Titre du cours" />
  

<meta name="author" content="Camille Signoretto, Maîtresse de conférences en économie, Université Paris Cité" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="09-Intro-a-Shiny-theorique.html"/>
<link rel="next" href="11-Clustering-theorique.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.10.4/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    background-color: #ffffff;
    color: #a0a0a0;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #a0a0a0;  padding-left: 4px; }
div.sourceCode
  { color: #1f1c1b; background-color: #ffffff; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #1f1c1b; } /* Normal */
code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
code span.an { color: #ca60ca; } /* Annotation */
code span.at { color: #0057ae; } /* Attribute */
code span.bn { color: #b08000; } /* BaseN */
code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
code span.ch { color: #924c9d; } /* Char */
code span.cn { color: #aa5500; } /* Constant */
code span.co { color: #898887; } /* Comment */
code span.cv { color: #0095ff; } /* CommentVar */
code span.do { color: #607880; } /* Documentation */
code span.dt { color: #0057ae; } /* DataType */
code span.dv { color: #b08000; } /* DecVal */
code span.er { color: #bf0303; text-decoration: underline; } /* Error */
code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
code span.fl { color: #b08000; } /* Float */
code span.fu { color: #644a9b; } /* Function */
code span.im { color: #ff5500; } /* Import */
code span.in { color: #b08000; } /* Information */
code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
code span.op { color: #1f1c1b; } /* Operator */
code span.ot { color: #006e28; } /* Other */
code span.pp { color: #006e28; } /* Preprocessor */
code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
code span.sc { color: #3daee9; } /* SpecialChar */
code span.ss { color: #ff5500; } /* SpecialString */
code span.st { color: #bf0303; } /* String */
code span.va { color: #0057ae; } /* Variable */
code span.vs { color: #bf0303; } /* VerbatimString */
code span.wa { color: #bf0303; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="css/tidyverse.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data Mining :  <em>Camille Signoretto</em></a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="00-Presentation.html"><a href="00-Presentation.html"><i class="fa fa-check"></i>Présentation</a>
<ul>
<li class="chapter" data-level="" data-path="00-Presentation.html"><a href="00-Presentation.html#à-propos-de-ce-document"><i class="fa fa-check"></i>À propos de ce document</a></li>
<li class="chapter" data-level="" data-path="00-Presentation.html"><a href="00-Presentation.html#prérequis"><i class="fa fa-check"></i>Prérequis</a></li>
<li class="chapter" data-level="" data-path="00-Presentation.html"><a href="00-Presentation.html#remerciements"><i class="fa fa-check"></i>Remerciements</a></li>
<li class="chapter" data-level="" data-path="00-Presentation.html"><a href="00-Presentation.html#licence"><i class="fa fa-check"></i>Licence</a></li>
</ul></li>
<li class="part"><span><b>Séance 1 : Data Wrangling</b></span></li>
<li class="chapter" data-level="1" data-path="01-Base-de-donnees.html"><a href="01-Base-de-donnees.html"><i class="fa fa-check"></i><b>1</b> Récupération de la base de données</a>
<ul>
<li class="chapter" data-level="1.1" data-path="01-Base-de-donnees.html"><a href="01-Base-de-donnees.html#les-données-du-recensement-de-la-population-rp"><i class="fa fa-check"></i><b>1.1</b> Les données du Recensement de la Population (RP)</a></li>
<li class="chapter" data-level="1.2" data-path="01-Base-de-donnees.html"><a href="01-Base-de-donnees.html#quelles-informations-intéressantes-dans-cette-base"><i class="fa fa-check"></i><b>1.2</b> Quelles informations intéressantes dans cette base ?</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="02-Manipulation-base.html"><a href="02-Manipulation-base.html"><i class="fa fa-check"></i><b>2</b> Manipulation de la base</a>
<ul>
<li class="chapter" data-level="2.1" data-path="02-Manipulation-base.html"><a href="02-Manipulation-base.html#format-des-données---wide-ou-long"><i class="fa fa-check"></i><b>2.1</b> Format des données - WIDE ou LONG</a></li>
<li class="chapter" data-level="2.2" data-path="02-Manipulation-base.html"><a href="02-Manipulation-base.html#sélectionner-un-champ-réduit-de-la-base-séparer-les-données"><i class="fa fa-check"></i><b>2.2</b> Sélectionner un champ réduit de la base, séparer les données</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="03-Manipulation-variables.html"><a href="03-Manipulation-variables.html"><i class="fa fa-check"></i><b>3</b> Manipulation des variables</a>
<ul>
<li class="chapter" data-level="3.1" data-path="03-Manipulation-variables.html"><a href="03-Manipulation-variables.html#manipulation-des-variables-qualitatives"><i class="fa fa-check"></i><b>3.1</b> Manipulation des variables qualitatives</a></li>
<li class="chapter" data-level="3.2" data-path="03-Manipulation-variables.html"><a href="03-Manipulation-variables.html#manipulation-des-variables-quantitatives"><i class="fa fa-check"></i><b>3.2</b> Manipulation des variables quantitatives</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="03-Manipulation-variables.html"><a href="03-Manipulation-variables.html#détecter-et-visualiser-les-valeurs-manquantes"><i class="fa fa-check"></i><b>3.2.1</b> Détecter et “visualiser” les valeurs manquantes</a></li>
<li class="chapter" data-level="3.2.2" data-path="03-Manipulation-variables.html"><a href="03-Manipulation-variables.html#gérer-les-valeurs-manquantes"><i class="fa fa-check"></i><b>3.2.2</b> Gérer les valeurs manquantes</a></li>
<li class="chapter" data-level="3.2.3" data-path="03-Manipulation-variables.html"><a href="03-Manipulation-variables.html#détecter-et-visualiser-les-valeurs-aberrantes"><i class="fa fa-check"></i><b>3.2.3</b> Détecter et “visualiser” les valeurs aberrantes</a></li>
<li class="chapter" data-level="3.2.4" data-path="03-Manipulation-variables.html"><a href="03-Manipulation-variables.html#découper-en-classes-une-variable-quantitative"><i class="fa fa-check"></i><b>3.2.4</b> Découper en classes une variable quantitative</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="04-Récapitulatif.html"><a href="04-Récapitulatif.html"><i class="fa fa-check"></i><b>4</b> Récapitulatig séance 1 - Data Wrangling</a>
<ul>
<li class="chapter" data-level="4.1" data-path="04-Récapitulatif.html"><a href="04-Récapitulatif.html#ce-quon-a-appris"><i class="fa fa-check"></i><b>4.1</b> Ce qu’on a appris</a></li>
<li class="chapter" data-level="4.2" data-path="04-Récapitulatif.html"><a href="04-Récapitulatif.html#enregistrement-des-tables"><i class="fa fa-check"></i><b>4.2</b> Enregistrement des tables</a></li>
</ul></li>
<li class="part"><span><b>Séance 2 : Data Mining - Analyse descriptive</b></span></li>
<li class="chapter" data-level="5" data-path="05-Questions-fouille-donnees.html"><a href="05-Questions-fouille-donnees.html"><i class="fa fa-check"></i><b>5</b> Quelles questions intéressantes pour une “fouille de données” sur cette base ?</a>
<ul>
<li class="chapter" data-level="5.1" data-path="05-Questions-fouille-donnees.html"><a href="05-Questions-fouille-donnees.html#caractéristiques-de-la-population-résidant-à-paris"><i class="fa fa-check"></i><b>5.1</b> Caractéristiques de la population résidant à Paris</a></li>
<li class="chapter" data-level="5.2" data-path="05-Questions-fouille-donnees.html"><a href="05-Questions-fouille-donnees.html#caractéristiques-de-la-population-active-résidant-à-paris"><i class="fa fa-check"></i><b>5.2</b> Caractéristiques de la population active résidant à Paris</a></li>
<li class="chapter" data-level="5.3" data-path="05-Questions-fouille-donnees.html"><a href="05-Questions-fouille-donnees.html#caractéristiques-des-logements-parisiens"><i class="fa fa-check"></i><b>5.3</b> Caractéristiques des logements parisiens</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="06-Fonctions.html"><a href="06-Fonctions.html"><i class="fa fa-check"></i><b>6</b> Systématiser nos procédures : construire une fonction</a>
<ul>
<li class="chapter" data-level="6.1" data-path="06-Fonctions.html"><a href="06-Fonctions.html#principes-généraux-dune-fonction"><i class="fa fa-check"></i><b>6.1</b> Principes généraux d’une fonction</a></li>
<li class="chapter" data-level="6.2" data-path="06-Fonctions.html"><a href="06-Fonctions.html#exemples-de-fonctions"><i class="fa fa-check"></i><b>6.2</b> Exemples de fonctions</a></li>
</ul></li>
<li class="part"><span><b>Séance 3 : Data Mining - Data Visualization</b></span></li>
<li class="chapter" data-level="7" data-path="07-Ggplot-theorique.html"><a href="07-Ggplot-theorique.html"><i class="fa fa-check"></i><b>7</b> Data Visualization et Ggplot2 : aspects théoriques</a>
<ul>
<li class="chapter" data-level="7.1" data-path="07-Ggplot-theorique.html"><a href="07-Ggplot-theorique.html#présentation-générale-de-ggplot2"><i class="fa fa-check"></i><b>7.1</b> Présentation générale de Ggplot2</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="07-Ggplot-theorique.html"><a href="07-Ggplot-theorique.html#les-aesthetics-ou-arguments-esthétiques"><i class="fa fa-check"></i><b>7.1.1</b> Les “aesthetics” ou arguments esthétiques</a></li>
<li class="chapter" data-level="7.1.2" data-path="07-Ggplot-theorique.html"><a href="07-Ggplot-theorique.html#les-géométries"><i class="fa fa-check"></i><b>7.1.2</b> Les géométries</a></li>
<li class="chapter" data-level="7.1.3" data-path="07-Ggplot-theorique.html"><a href="07-Ggplot-theorique.html#les-facettes"><i class="fa fa-check"></i><b>7.1.3</b> Les facettes</a></li>
<li class="chapter" data-level="7.1.4" data-path="07-Ggplot-theorique.html"><a href="07-Ggplot-theorique.html#les-statistiques"><i class="fa fa-check"></i><b>7.1.4</b> Les statistiques</a></li>
<li class="chapter" data-level="7.1.5" data-path="07-Ggplot-theorique.html"><a href="07-Ggplot-theorique.html#les-coordonnées"><i class="fa fa-check"></i><b>7.1.5</b> Les coordonnées</a></li>
<li class="chapter" data-level="7.1.6" data-path="07-Ggplot-theorique.html"><a href="07-Ggplot-theorique.html#les-thèmes"><i class="fa fa-check"></i><b>7.1.6</b> Les thèmes</a></li>
<li class="chapter" data-level="7.1.7" data-path="07-Ggplot-theorique.html"><a href="07-Ggplot-theorique.html#les-autres-options-graphiques-titres-échelles-des-axes-etc."><i class="fa fa-check"></i><b>7.1.7</b> Les autres options graphiques : titres, échelles des axes, etc.</a></li>
<li class="chapter" data-level="7.1.8" data-path="07-Ggplot-theorique.html"><a href="07-Ggplot-theorique.html#code-minimal"><i class="fa fa-check"></i><b>7.1.8</b> Code minimal</a></li>
<li class="chapter" data-level="7.1.9" data-path="07-Ggplot-theorique.html"><a href="07-Ggplot-theorique.html#liens-utiles-pour-aller-plus-loin"><i class="fa fa-check"></i><b>7.1.9</b> Liens utiles pour aller plus loin</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="07-Ggplot-theorique.html"><a href="07-Ggplot-theorique.html#les-grands-principes-de-data-visualization"><i class="fa fa-check"></i><b>7.2</b> Les grands principes de data visualization</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="08-Ggplot-pratique.html"><a href="08-Ggplot-pratique.html"><i class="fa fa-check"></i><b>8</b> Data Mining et Data Visualization en pratique</a>
<ul>
<li class="chapter" data-level="8.1" data-path="08-Ggplot-pratique.html"><a href="08-Ggplot-pratique.html#exemple-de-la-construction-dun-graphique-pas-à-pas"><i class="fa fa-check"></i><b>8.1</b> Exemple de la construction d’un graphique pas à pas</a></li>
<li class="chapter" data-level="8.2" data-path="08-Ggplot-pratique.html"><a href="08-Ggplot-pratique.html#dautres-exemples-à-travers-des-exercices"><i class="fa fa-check"></i><b>8.2</b> D’autres exemples à travers des exercices</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="08-Ggplot-pratique.html"><a href="08-Ggplot-pratique.html#distribution-du-prix-au-m2-pour-les-appartements-parisiens-selon-lannée"><i class="fa fa-check"></i><b>8.2.1</b> Distribution du prix au m2 pour les appartements parisiens, selon l’année</a></li>
<li class="chapter" data-level="8.2.2" data-path="08-Ggplot-pratique.html"><a href="08-Ggplot-pratique.html#comparaison-des-montants-moyen-et-médian-du-prix-au-m2-par-arrondissement-de-paris"><i class="fa fa-check"></i><b>8.2.2</b> Comparaison des montants moyen et médian du prix au m2, par arrondissement de Paris</a></li>
<li class="chapter" data-level="8.2.3" data-path="08-Ggplot-pratique.html"><a href="08-Ggplot-pratique.html#evolution-du-prix-médian-au-m2-des-ventes-dappartements-à-paris"><i class="fa fa-check"></i><b>8.2.3</b> Evolution du prix médian au m2 des ventes d’appartements à Paris</a></li>
<li class="chapter" data-level="8.2.4" data-path="08-Ggplot-pratique.html"><a href="08-Ggplot-pratique.html#top-5-du-prix-au-m2-des-ventes-dappartements-selon-les-arrondissements"><i class="fa fa-check"></i><b>8.2.4</b> Top 5 du prix au m2 des ventes d’appartements selon les arrondissements</a></li>
<li class="chapter" data-level="8.2.5" data-path="08-Ggplot-pratique.html"><a href="08-Ggplot-pratique.html#à-vous-de-jouer"><i class="fa fa-check"></i><b>8.2.5</b> À vous de “jouer” !</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>Séance 4 : Data Visualization - Introduction à ShinyApp</b></span></li>
<li class="chapter" data-level="9" data-path="09-Intro-a-Shiny-theorique.html"><a href="09-Intro-a-Shiny-theorique.html"><i class="fa fa-check"></i><b>9</b> Les applications interactives avec Shiny App</a>
<ul>
<li class="chapter" data-level="9.1" data-path="09-Intro-a-Shiny-theorique.html"><a href="09-Intro-a-Shiny-theorique.html#la-structure-générale-dune-application-shiny"><i class="fa fa-check"></i><b>9.1</b> La structure générale d’une application Shiny</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="09-Intro-a-Shiny-theorique.html"><a href="09-Intro-a-Shiny-theorique.html#la-partie-ui"><i class="fa fa-check"></i><b>9.1.1</b> La partie “UI”</a></li>
<li class="chapter" data-level="9.1.2" data-path="09-Intro-a-Shiny-theorique.html"><a href="09-Intro-a-Shiny-theorique.html#la-partie-server"><i class="fa fa-check"></i><b>9.1.2</b> La partie “Server”</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="09-Intro-a-Shiny-theorique.html"><a href="09-Intro-a-Shiny-theorique.html#la-réactivité"><i class="fa fa-check"></i><b>9.2</b> La réactivité</a></li>
<li class="chapter" data-level="9.3" data-path="09-Intro-a-Shiny-theorique.html"><a href="09-Intro-a-Shiny-theorique.html#un-exemple-avec-le-code-du-script-par-défaut"><i class="fa fa-check"></i><b>9.3</b> Un exemple avec le code du script par défaut</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="10-Intro-a-Shiny-exemples.html"><a href="10-Intro-a-Shiny-exemples.html"><i class="fa fa-check"></i><b>10</b> La création d’une application Shiny “pas à pas” avec l’une de nos bases de données</a>
<ul>
<li class="chapter" data-level="10.1" data-path="10-Intro-a-Shiny-exemples.html"><a href="10-Intro-a-Shiny-exemples.html#application-vide"><i class="fa fa-check"></i><b>10.1</b> Application vide</a></li>
<li class="chapter" data-level="10.2" data-path="10-Intro-a-Shiny-exemples.html"><a href="10-Intro-a-Shiny-exemples.html#ajout-dun-titre-et-dun-widget"><i class="fa fa-check"></i><b>10.2</b> Ajout d’un titre et d’un widget</a></li>
<li class="chapter" data-level="10.3" data-path="10-Intro-a-Shiny-exemples.html"><a href="10-Intro-a-Shiny-exemples.html#ajout-dun-graphique"><i class="fa fa-check"></i><b>10.3</b> Ajout d’un graphique</a></li>
<li class="chapter" data-level="10.4" data-path="10-Intro-a-Shiny-exemples.html"><a href="10-Intro-a-Shiny-exemples.html#modification-du-graphique-filtrer-selon-une-variable"><i class="fa fa-check"></i><b>10.4</b> Modification du graphique : filtrer selon une variable</a></li>
<li class="chapter" data-level="10.5" data-path="10-Intro-a-Shiny-exemples.html"><a href="10-Intro-a-Shiny-exemples.html#modification-du-graphique-selon-une-variable-au-choix-parmi-deux"><i class="fa fa-check"></i><b>10.5</b> Modification du graphique : selon une variable au choix parmi deux</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="10-Intro-a-Shiny-exemples.html"><a href="10-Intro-a-Shiny-exemples.html#applications-plus-poussées-sur-shiny"><i class="fa fa-check"></i><b>11</b> Applications plus poussées sur Shiny</a>
<ul>
<li class="chapter" data-level="11.1" data-path="10-Intro-a-Shiny-exemples.html"><a href="10-Intro-a-Shiny-exemples.html#application-avec-un-tableau-et-un-graphique-sur-une-autre-base-de-données"><i class="fa fa-check"></i><b>11.1</b> Application avec un tableau et un graphique sur une autre base de données</a></li>
<li class="chapter" data-level="11.2" data-path="10-Intro-a-Shiny-exemples.html"><a href="10-Intro-a-Shiny-exemples.html#introduction-dune-réactivité-appliquée-à-la-table-de-données"><i class="fa fa-check"></i><b>11.2</b> Introduction d’une réactivité appliquée à la table de données</a></li>
<li class="chapter" data-level="11.3" data-path="10-Intro-a-Shiny-exemples.html"><a href="10-Intro-a-Shiny-exemples.html#introduction-dune-réactivité-sur-les-inputs-contexte-réactif"><i class="fa fa-check"></i><b>11.3</b> Introduction d’une réactivité sur les inputs (contexte réactif)</a></li>
</ul></li>
<li class="part"><span><b>Séance 5 : Data Mining - Clustering</b></span></li>
<li class="chapter" data-level="12" data-path="11-Clustering-theorique.html"><a href="11-Clustering-theorique.html"><i class="fa fa-check"></i><b>12</b> Clustering : aspects théoriques</a>
<ul>
<li class="chapter" data-level="12.1" data-path="11-Clustering-theorique.html"><a href="11-Clustering-theorique.html#la-classification-ascendante-hiérarchique-cah"><i class="fa fa-check"></i><b>12.1</b> La classification ascendante hiérarchique (CAH)</a></li>
<li class="chapter" data-level="12.2" data-path="11-Clustering-theorique.html"><a href="11-Clustering-theorique.html#la-méthode-des-centres-mobiles-et-sa-variante-les-k-means"><i class="fa fa-check"></i><b>12.2</b> La méthode des centres mobiles et sa variante, <em>les K-means</em></a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">DATA MINING</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="c10-Intro-a-Shiny-exemples" class="section level1 hasAnchor" number="10">
<h1><span class="header-section-number">Section 10</span> La création d’une application Shiny “pas à pas” avec l’une de nos bases de données<a href="10-Intro-a-Shiny-exemples.html#c10-Intro-a-Shiny-exemples" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div align="justify">
<p>On va utiliser la base du RP sur laquelle nous travaillons depuis le début, mais en créant des tableaux de contingence à partir des fonctions sauvegardées dans la section précédente.</p>
<div id="application-vide" class="section level2 hasAnchor" number="10.1">
<h2><span class="header-section-number">10.1</span> Application vide<a href="10-Intro-a-Shiny-exemples.html#application-vide" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Faisons tourner une application vide et ajoutons au fur et à mesure les éléments qui permettrons de construire une vraie application :</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="10-Intro-a-Shiny-exemples.html#cb125-1" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb125-2"><a href="10-Intro-a-Shiny-exemples.html#cb125-2" tabindex="-1"></a></span>
<span id="cb125-3"><a href="10-Intro-a-Shiny-exemples.html#cb125-3" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb125-4"><a href="10-Intro-a-Shiny-exemples.html#cb125-4" tabindex="-1"></a>                )</span>
<span id="cb125-5"><a href="10-Intro-a-Shiny-exemples.html#cb125-5" tabindex="-1"></a></span>
<span id="cb125-6"><a href="10-Intro-a-Shiny-exemples.html#cb125-6" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, </span>
<span id="cb125-7"><a href="10-Intro-a-Shiny-exemples.html#cb125-7" tabindex="-1"></a>                   output) {</span>
<span id="cb125-8"><a href="10-Intro-a-Shiny-exemples.html#cb125-8" tabindex="-1"></a>  </span>
<span id="cb125-9"><a href="10-Intro-a-Shiny-exemples.html#cb125-9" tabindex="-1"></a>                   }</span>
<span id="cb125-10"><a href="10-Intro-a-Shiny-exemples.html#cb125-10" tabindex="-1"></a></span>
<span id="cb125-11"><a href="10-Intro-a-Shiny-exemples.html#cb125-11" tabindex="-1"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span></code></pre></div>
</div>
<div id="ajout-dun-titre-et-dun-widget" class="section level2 hasAnchor" number="10.2">
<h2><span class="header-section-number">10.2</span> Ajout d’un titre et d’un widget<a href="10-Intro-a-Shiny-exemples.html#ajout-dun-titre-et-dun-widget" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Ajoutons un titre et un widget, par exemple une barre “slider” :</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="10-Intro-a-Shiny-exemples.html#cb126-1" tabindex="-1"></a><span class="co">#library(shiny)</span></span>
<span id="cb126-2"><a href="10-Intro-a-Shiny-exemples.html#cb126-2" tabindex="-1"></a></span>
<span id="cb126-3"><a href="10-Intro-a-Shiny-exemples.html#cb126-3" tabindex="-1"></a><span class="co"># Définition UI et Server de l&#39;application Shiny</span></span>
<span id="cb126-4"><a href="10-Intro-a-Shiny-exemples.html#cb126-4" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb126-5"><a href="10-Intro-a-Shiny-exemples.html#cb126-5" tabindex="-1"></a>  <span class="co"># Titre de l&#39;application</span></span>
<span id="cb126-6"><a href="10-Intro-a-Shiny-exemples.html#cb126-6" tabindex="-1"></a>  <span class="fu">titlePanel</span>(<span class="st">&quot;Nombre de propriétaires agrégé au niveau communal dans Paris et sa petite couronne&quot;</span>),</span>
<span id="cb126-7"><a href="10-Intro-a-Shiny-exemples.html#cb126-7" tabindex="-1"></a>  </span>
<span id="cb126-8"><a href="10-Intro-a-Shiny-exemples.html#cb126-8" tabindex="-1"></a>  <span class="co"># Définition du Widget - ici un slider en vue de construire un histogramme</span></span>
<span id="cb126-9"><a href="10-Intro-a-Shiny-exemples.html#cb126-9" tabindex="-1"></a>  <span class="fu">sidebarLayout</span>(</span>
<span id="cb126-10"><a href="10-Intro-a-Shiny-exemples.html#cb126-10" tabindex="-1"></a>    <span class="fu">sidebarPanel</span>(</span>
<span id="cb126-11"><a href="10-Intro-a-Shiny-exemples.html#cb126-11" tabindex="-1"></a>      <span class="fu">sliderInput</span>(<span class="at">inputId =</span> <span class="st">&quot;Classes&quot;</span>,</span>
<span id="cb126-12"><a href="10-Intro-a-Shiny-exemples.html#cb126-12" tabindex="-1"></a>                  <span class="at">label =</span> <span class="st">&quot;Nombres de classes : &quot;</span>,</span>
<span id="cb126-13"><a href="10-Intro-a-Shiny-exemples.html#cb126-13" tabindex="-1"></a>                  <span class="at">min =</span> <span class="dv">1</span>,</span>
<span id="cb126-14"><a href="10-Intro-a-Shiny-exemples.html#cb126-14" tabindex="-1"></a>                  <span class="at">max =</span> <span class="dv">50</span>,</span>
<span id="cb126-15"><a href="10-Intro-a-Shiny-exemples.html#cb126-15" tabindex="-1"></a>                  <span class="at">value =</span> <span class="dv">25</span>)</span>
<span id="cb126-16"><a href="10-Intro-a-Shiny-exemples.html#cb126-16" tabindex="-1"></a>      ),</span>
<span id="cb126-17"><a href="10-Intro-a-Shiny-exemples.html#cb126-17" tabindex="-1"></a>    </span>
<span id="cb126-18"><a href="10-Intro-a-Shiny-exemples.html#cb126-18" tabindex="-1"></a>  <span class="fu">mainPanel</span>(</span>
<span id="cb126-19"><a href="10-Intro-a-Shiny-exemples.html#cb126-19" tabindex="-1"></a>    <span class="fu">plotOutput</span>(<span class="st">&quot;histPlot&quot;</span>)</span>
<span id="cb126-20"><a href="10-Intro-a-Shiny-exemples.html#cb126-20" tabindex="-1"></a>    </span>
<span id="cb126-21"><a href="10-Intro-a-Shiny-exemples.html#cb126-21" tabindex="-1"></a>    )</span>
<span id="cb126-22"><a href="10-Intro-a-Shiny-exemples.html#cb126-22" tabindex="-1"></a>  )</span>
<span id="cb126-23"><a href="10-Intro-a-Shiny-exemples.html#cb126-23" tabindex="-1"></a>)</span>
<span id="cb126-24"><a href="10-Intro-a-Shiny-exemples.html#cb126-24" tabindex="-1"></a></span>
<span id="cb126-25"><a href="10-Intro-a-Shiny-exemples.html#cb126-25" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output) {</span>
<span id="cb126-26"><a href="10-Intro-a-Shiny-exemples.html#cb126-26" tabindex="-1"></a>  </span>
<span id="cb126-27"><a href="10-Intro-a-Shiny-exemples.html#cb126-27" tabindex="-1"></a>}</span>
<span id="cb126-28"><a href="10-Intro-a-Shiny-exemples.html#cb126-28" tabindex="-1"></a></span>
<span id="cb126-29"><a href="10-Intro-a-Shiny-exemples.html#cb126-29" tabindex="-1"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span></code></pre></div>
</div>
<div id="ajout-dun-graphique" class="section level2 hasAnchor" number="10.3">
<h2><span class="header-section-number">10.3</span> Ajout d’un graphique<a href="10-Intro-a-Shiny-exemples.html#ajout-dun-graphique" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Ajoutons un graphique ; il faut pour cela charger la base de données sur laquelle nous allons travailler ; pour l’exemple ici, nous allons créer un tableau de contingence à partir des fonctions créées précédemment (qu’on appelle donc avant) et donnant le nombre de propriétaires par commune de l’Île-de-France, en considérant les arrondissements de Paris comme des communes :</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="10-Intro-a-Shiny-exemples.html#cb127-1" tabindex="-1"></a><span class="co"># appel fonctions enregistrées</span></span>
<span id="cb127-2"><a href="10-Intro-a-Shiny-exemples.html#cb127-2" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;fonctions/fonctions.R&quot;</span>)</span>
<span id="cb127-3"><a href="10-Intro-a-Shiny-exemples.html#cb127-3" tabindex="-1"></a></span>
<span id="cb127-4"><a href="10-Intro-a-Shiny-exemples.html#cb127-4" tabindex="-1"></a><span class="co"># création de la table de données</span></span>
<span id="cb127-5"><a href="10-Intro-a-Shiny-exemples.html#cb127-5" tabindex="-1"></a>tab_proprio_com <span class="ot">&lt;-</span> RP_final <span class="sc">%&gt;%</span> <span class="fu">filter</span>(STOCD <span class="sc">==</span> <span class="st">&quot;10&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb127-6"><a href="10-Intro-a-Shiny-exemples.html#cb127-6" tabindex="-1"></a>                                      <span class="fu">somme</span>(<span class="at">var_gpe=</span>COM, <span class="at">nom_var=</span>STOCD) <span class="sc">%&gt;%</span> </span>
<span id="cb127-7"><a href="10-Intro-a-Shiny-exemples.html#cb127-7" tabindex="-1"></a>                                      <span class="fu">rename</span>(<span class="at">nb_proprio =</span> <span class="st">&#39;10&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb127-8"><a href="10-Intro-a-Shiny-exemples.html#cb127-8" tabindex="-1"></a>                                      <span class="fu">filter</span>(COM<span class="sc">!=</span><span class="st">&quot;ZZZZZ&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="10-Intro-a-Shiny-exemples.html#cb128-1" tabindex="-1"></a><span class="co">#library(shiny)</span></span>
<span id="cb128-2"><a href="10-Intro-a-Shiny-exemples.html#cb128-2" tabindex="-1"></a></span>
<span id="cb128-3"><a href="10-Intro-a-Shiny-exemples.html#cb128-3" tabindex="-1"></a></span>
<span id="cb128-4"><a href="10-Intro-a-Shiny-exemples.html#cb128-4" tabindex="-1"></a><span class="co"># Définition UI et Server de l&#39;application Shiny</span></span>
<span id="cb128-5"><a href="10-Intro-a-Shiny-exemples.html#cb128-5" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb128-6"><a href="10-Intro-a-Shiny-exemples.html#cb128-6" tabindex="-1"></a>  <span class="co"># Titre de l&#39;application</span></span>
<span id="cb128-7"><a href="10-Intro-a-Shiny-exemples.html#cb128-7" tabindex="-1"></a>  <span class="fu">titlePanel</span>(<span class="st">&quot;Nombre de propriétaires agrégé au niveau communal dans Paris et sa petite couronne&quot;</span>),</span>
<span id="cb128-8"><a href="10-Intro-a-Shiny-exemples.html#cb128-8" tabindex="-1"></a>  </span>
<span id="cb128-9"><a href="10-Intro-a-Shiny-exemples.html#cb128-9" tabindex="-1"></a>  <span class="co"># Définition du Widget - ici un slider en vue de construire un histogramme</span></span>
<span id="cb128-10"><a href="10-Intro-a-Shiny-exemples.html#cb128-10" tabindex="-1"></a>    <span class="fu">sidebarLayout</span>(</span>
<span id="cb128-11"><a href="10-Intro-a-Shiny-exemples.html#cb128-11" tabindex="-1"></a>        <span class="fu">sidebarPanel</span>(</span>
<span id="cb128-12"><a href="10-Intro-a-Shiny-exemples.html#cb128-12" tabindex="-1"></a>            <span class="fu">sliderInput</span>(<span class="at">inputId =</span> <span class="st">&quot;classes&quot;</span>,</span>
<span id="cb128-13"><a href="10-Intro-a-Shiny-exemples.html#cb128-13" tabindex="-1"></a>                        <span class="at">label =</span> <span class="st">&quot;Nombres de classes&quot;</span>,</span>
<span id="cb128-14"><a href="10-Intro-a-Shiny-exemples.html#cb128-14" tabindex="-1"></a>                        <span class="at">min =</span> <span class="dv">1</span>,</span>
<span id="cb128-15"><a href="10-Intro-a-Shiny-exemples.html#cb128-15" tabindex="-1"></a>                        <span class="at">max =</span> <span class="dv">50</span>,</span>
<span id="cb128-16"><a href="10-Intro-a-Shiny-exemples.html#cb128-16" tabindex="-1"></a>                        <span class="at">value =</span> <span class="dv">25</span>)</span>
<span id="cb128-17"><a href="10-Intro-a-Shiny-exemples.html#cb128-17" tabindex="-1"></a>        ),</span>
<span id="cb128-18"><a href="10-Intro-a-Shiny-exemples.html#cb128-18" tabindex="-1"></a></span>
<span id="cb128-19"><a href="10-Intro-a-Shiny-exemples.html#cb128-19" tabindex="-1"></a>        <span class="co"># Graphe montré à l&#39;utilisateur</span></span>
<span id="cb128-20"><a href="10-Intro-a-Shiny-exemples.html#cb128-20" tabindex="-1"></a>        <span class="fu">mainPanel</span>(</span>
<span id="cb128-21"><a href="10-Intro-a-Shiny-exemples.html#cb128-21" tabindex="-1"></a>           <span class="fu">plotOutput</span>(<span class="st">&quot;histPlot&quot;</span>)</span>
<span id="cb128-22"><a href="10-Intro-a-Shiny-exemples.html#cb128-22" tabindex="-1"></a>        )</span>
<span id="cb128-23"><a href="10-Intro-a-Shiny-exemples.html#cb128-23" tabindex="-1"></a>  )</span>
<span id="cb128-24"><a href="10-Intro-a-Shiny-exemples.html#cb128-24" tabindex="-1"></a>)</span>
<span id="cb128-25"><a href="10-Intro-a-Shiny-exemples.html#cb128-25" tabindex="-1"></a></span>
<span id="cb128-26"><a href="10-Intro-a-Shiny-exemples.html#cb128-26" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, </span>
<span id="cb128-27"><a href="10-Intro-a-Shiny-exemples.html#cb128-27" tabindex="-1"></a>                   output) {</span>
<span id="cb128-28"><a href="10-Intro-a-Shiny-exemples.html#cb128-28" tabindex="-1"></a>output<span class="sc">$</span>histPlot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb128-29"><a href="10-Intro-a-Shiny-exemples.html#cb128-29" tabindex="-1"></a>  tab_proprio_com <span class="sc">%&gt;%</span>  </span>
<span id="cb128-30"><a href="10-Intro-a-Shiny-exemples.html#cb128-30" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">aes</span>(<span class="at">x=</span>nb_proprio) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">25</span>)</span>
<span id="cb128-31"><a href="10-Intro-a-Shiny-exemples.html#cb128-31" tabindex="-1"></a>})</span>
<span id="cb128-32"><a href="10-Intro-a-Shiny-exemples.html#cb128-32" tabindex="-1"></a></span>
<span id="cb128-33"><a href="10-Intro-a-Shiny-exemples.html#cb128-33" tabindex="-1"></a>  }</span>
<span id="cb128-34"><a href="10-Intro-a-Shiny-exemples.html#cb128-34" tabindex="-1"></a></span>
<span id="cb128-35"><a href="10-Intro-a-Shiny-exemples.html#cb128-35" tabindex="-1"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span></code></pre></div>
<p>On a bien maintenant le graphique qui s’affiche mais lorsqu’on change le nombre de classes dans la barre slider, rien ne se passe… C’est normal, nous n’avons pas encore introduit de réactivité dans l’application.</p>
<p>Pour cela, il va falloir modifier le code dans la fonction <strong><code>server</code></strong> et ainsi mettre en lien des informations indiquées dans la fonction <strong><code>UI</code></strong> avec les arguments utilisés dans le graphique développé dans la fonction <strong><code>server</code></strong>. Pour l’instant, on veut pouvoir modifier le nombre de classes, l’argument pour cela dans la fonction <code>geom_histogram()</code> dans le <code>ggplot()</code> est <code>bins=</code> ; on a indiqué ‘50’ jusqu’ici ; maintenant il faut lui indiquer le nombre que l’utilisateur va lui-même indiquer dans la barre slider ; cela se fait avec l’argument <code>input$...</code>, les “…” devant être remplacés par le nom que l’on a donné à l’<code>inputId</code> dans le <code>sliderInput()</code>, donc ici “classes”.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="10-Intro-a-Shiny-exemples.html#cb129-1" tabindex="-1"></a><span class="co"># Définition UI et Server de l&#39;application Shiny</span></span>
<span id="cb129-2"><a href="10-Intro-a-Shiny-exemples.html#cb129-2" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb129-3"><a href="10-Intro-a-Shiny-exemples.html#cb129-3" tabindex="-1"></a>  <span class="co"># Titre de l&#39;application</span></span>
<span id="cb129-4"><a href="10-Intro-a-Shiny-exemples.html#cb129-4" tabindex="-1"></a>  <span class="fu">titlePanel</span>(<span class="st">&quot;Nombre de propriétaires agrégé au niveau communal dans Paris et sa petite couronne&quot;</span>),</span>
<span id="cb129-5"><a href="10-Intro-a-Shiny-exemples.html#cb129-5" tabindex="-1"></a>  </span>
<span id="cb129-6"><a href="10-Intro-a-Shiny-exemples.html#cb129-6" tabindex="-1"></a>  <span class="co"># Définition du Widget - ici un slider en vue de construire un histogramme</span></span>
<span id="cb129-7"><a href="10-Intro-a-Shiny-exemples.html#cb129-7" tabindex="-1"></a>  <span class="fu">sidebarLayout</span>(</span>
<span id="cb129-8"><a href="10-Intro-a-Shiny-exemples.html#cb129-8" tabindex="-1"></a>    <span class="fu">sidebarPanel</span>(</span>
<span id="cb129-9"><a href="10-Intro-a-Shiny-exemples.html#cb129-9" tabindex="-1"></a>      <span class="fu">sliderInput</span>(<span class="at">inputId =</span> <span class="st">&quot;classes&quot;</span>,</span>
<span id="cb129-10"><a href="10-Intro-a-Shiny-exemples.html#cb129-10" tabindex="-1"></a>                  <span class="at">label =</span> <span class="st">&quot;Nombres de classes&quot;</span>,</span>
<span id="cb129-11"><a href="10-Intro-a-Shiny-exemples.html#cb129-11" tabindex="-1"></a>                  <span class="at">min =</span> <span class="dv">1</span>,</span>
<span id="cb129-12"><a href="10-Intro-a-Shiny-exemples.html#cb129-12" tabindex="-1"></a>                  <span class="at">max =</span> <span class="dv">50</span>,</span>
<span id="cb129-13"><a href="10-Intro-a-Shiny-exemples.html#cb129-13" tabindex="-1"></a>                  <span class="at">value =</span> <span class="dv">25</span>)</span>
<span id="cb129-14"><a href="10-Intro-a-Shiny-exemples.html#cb129-14" tabindex="-1"></a>    ),</span>
<span id="cb129-15"><a href="10-Intro-a-Shiny-exemples.html#cb129-15" tabindex="-1"></a>    </span>
<span id="cb129-16"><a href="10-Intro-a-Shiny-exemples.html#cb129-16" tabindex="-1"></a>    <span class="co"># Graphe montré à l&#39;utilisateur</span></span>
<span id="cb129-17"><a href="10-Intro-a-Shiny-exemples.html#cb129-17" tabindex="-1"></a>    <span class="fu">mainPanel</span>(</span>
<span id="cb129-18"><a href="10-Intro-a-Shiny-exemples.html#cb129-18" tabindex="-1"></a>      <span class="fu">plotOutput</span>(<span class="st">&quot;histPlot&quot;</span>)</span>
<span id="cb129-19"><a href="10-Intro-a-Shiny-exemples.html#cb129-19" tabindex="-1"></a>    )</span>
<span id="cb129-20"><a href="10-Intro-a-Shiny-exemples.html#cb129-20" tabindex="-1"></a>  )</span>
<span id="cb129-21"><a href="10-Intro-a-Shiny-exemples.html#cb129-21" tabindex="-1"></a>)</span>
<span id="cb129-22"><a href="10-Intro-a-Shiny-exemples.html#cb129-22" tabindex="-1"></a></span>
<span id="cb129-23"><a href="10-Intro-a-Shiny-exemples.html#cb129-23" tabindex="-1"></a>  server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output) {</span>
<span id="cb129-24"><a href="10-Intro-a-Shiny-exemples.html#cb129-24" tabindex="-1"></a>  </span>
<span id="cb129-25"><a href="10-Intro-a-Shiny-exemples.html#cb129-25" tabindex="-1"></a>    output<span class="sc">$</span>histPlot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb129-26"><a href="10-Intro-a-Shiny-exemples.html#cb129-26" tabindex="-1"></a>      tab_proprio_com <span class="sc">%&gt;%</span>  </span>
<span id="cb129-27"><a href="10-Intro-a-Shiny-exemples.html#cb129-27" tabindex="-1"></a>        <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">aes</span>(<span class="at">x=</span>nb_proprio) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">bins=</span>input<span class="sc">$</span>classes)</span>
<span id="cb129-28"><a href="10-Intro-a-Shiny-exemples.html#cb129-28" tabindex="-1"></a>    })</span>
<span id="cb129-29"><a href="10-Intro-a-Shiny-exemples.html#cb129-29" tabindex="-1"></a>    </span>
<span id="cb129-30"><a href="10-Intro-a-Shiny-exemples.html#cb129-30" tabindex="-1"></a>  }</span>
<span id="cb129-31"><a href="10-Intro-a-Shiny-exemples.html#cb129-31" tabindex="-1"></a>  </span>
<span id="cb129-32"><a href="10-Intro-a-Shiny-exemples.html#cb129-32" tabindex="-1"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span></code></pre></div>
<p>Ça y est, maintenant lorsqu’on modifie le curseur dans la barre slider, le graphique change !</p>
</div>
<div id="modification-du-graphique-filtrer-selon-une-variable" class="section level2 hasAnchor" number="10.4">
<h2><span class="header-section-number">10.4</span> Modification du graphique : filtrer selon une variable<a href="10-Intro-a-Shiny-exemples.html#modification-du-graphique-filtrer-selon-une-variable" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Essayons ensuite d’ajouter un filtre sur le département pour n’avoir que la distribution du nombre de propriétaires pour un département donné. Comme on n’a pas de variable de département, il faut la créer, ce que l’on peut faire assez facilement à partir des deux premiers chiffres de la commune, et ensuite il suffit d’ajouter un filtre sur cette nouvelle variable créée.</p>
<p>De même, on peut procéder par étapes : présentons d’abord le graphique pour le seul département de l’Île-de-France (75).</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="10-Intro-a-Shiny-exemples.html#cb130-1" tabindex="-1"></a><span class="co"># Création de la variable et donc remplacement de la table de données</span></span>
<span id="cb130-2"><a href="10-Intro-a-Shiny-exemples.html#cb130-2" tabindex="-1"></a>tab_proprio_com <span class="ot">&lt;-</span> tab_proprio_com <span class="sc">%&gt;%</span></span>
<span id="cb130-3"><a href="10-Intro-a-Shiny-exemples.html#cb130-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DEPT=</span><span class="fu">as.factor</span>(<span class="fu">substr</span>(COM, <span class="dv">1</span>,<span class="dv">2</span>)))</span>
<span id="cb130-4"><a href="10-Intro-a-Shiny-exemples.html#cb130-4" tabindex="-1"></a></span>
<span id="cb130-5"><a href="10-Intro-a-Shiny-exemples.html#cb130-5" tabindex="-1"></a><span class="co"># Définition UI et Server de l&#39;application Shiny</span></span>
<span id="cb130-6"><a href="10-Intro-a-Shiny-exemples.html#cb130-6" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb130-7"><a href="10-Intro-a-Shiny-exemples.html#cb130-7" tabindex="-1"></a>  <span class="co"># Titre de l&#39;application</span></span>
<span id="cb130-8"><a href="10-Intro-a-Shiny-exemples.html#cb130-8" tabindex="-1"></a>  <span class="fu">titlePanel</span>(<span class="st">&quot;Nombre de propriétaires agrégé au niveau communal dans Paris et sa petite couronne&quot;</span>),</span>
<span id="cb130-9"><a href="10-Intro-a-Shiny-exemples.html#cb130-9" tabindex="-1"></a>  </span>
<span id="cb130-10"><a href="10-Intro-a-Shiny-exemples.html#cb130-10" tabindex="-1"></a>  <span class="co"># Définition du Widget - ici un slider en vue de construire un histogramme</span></span>
<span id="cb130-11"><a href="10-Intro-a-Shiny-exemples.html#cb130-11" tabindex="-1"></a>  <span class="fu">sidebarLayout</span>(</span>
<span id="cb130-12"><a href="10-Intro-a-Shiny-exemples.html#cb130-12" tabindex="-1"></a>    <span class="fu">sidebarPanel</span>(</span>
<span id="cb130-13"><a href="10-Intro-a-Shiny-exemples.html#cb130-13" tabindex="-1"></a>      <span class="fu">sliderInput</span>(<span class="at">inputId =</span> <span class="st">&quot;classes&quot;</span>,</span>
<span id="cb130-14"><a href="10-Intro-a-Shiny-exemples.html#cb130-14" tabindex="-1"></a>                  <span class="at">label =</span> <span class="st">&quot;Nombres de classes&quot;</span>,</span>
<span id="cb130-15"><a href="10-Intro-a-Shiny-exemples.html#cb130-15" tabindex="-1"></a>                  <span class="at">min =</span> <span class="dv">1</span>,</span>
<span id="cb130-16"><a href="10-Intro-a-Shiny-exemples.html#cb130-16" tabindex="-1"></a>                  <span class="at">max =</span> <span class="dv">50</span>,</span>
<span id="cb130-17"><a href="10-Intro-a-Shiny-exemples.html#cb130-17" tabindex="-1"></a>                  <span class="at">value =</span> <span class="dv">25</span>)</span>
<span id="cb130-18"><a href="10-Intro-a-Shiny-exemples.html#cb130-18" tabindex="-1"></a>    ),</span>
<span id="cb130-19"><a href="10-Intro-a-Shiny-exemples.html#cb130-19" tabindex="-1"></a>    </span>
<span id="cb130-20"><a href="10-Intro-a-Shiny-exemples.html#cb130-20" tabindex="-1"></a>    <span class="co"># Graphe montré à l&#39;utilisateur</span></span>
<span id="cb130-21"><a href="10-Intro-a-Shiny-exemples.html#cb130-21" tabindex="-1"></a>    <span class="fu">mainPanel</span>(</span>
<span id="cb130-22"><a href="10-Intro-a-Shiny-exemples.html#cb130-22" tabindex="-1"></a>      <span class="fu">plotOutput</span>(<span class="st">&quot;histPlot&quot;</span>)</span>
<span id="cb130-23"><a href="10-Intro-a-Shiny-exemples.html#cb130-23" tabindex="-1"></a>    )</span>
<span id="cb130-24"><a href="10-Intro-a-Shiny-exemples.html#cb130-24" tabindex="-1"></a>  )</span>
<span id="cb130-25"><a href="10-Intro-a-Shiny-exemples.html#cb130-25" tabindex="-1"></a>)</span>
<span id="cb130-26"><a href="10-Intro-a-Shiny-exemples.html#cb130-26" tabindex="-1"></a></span>
<span id="cb130-27"><a href="10-Intro-a-Shiny-exemples.html#cb130-27" tabindex="-1"></a>  server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output) {</span>
<span id="cb130-28"><a href="10-Intro-a-Shiny-exemples.html#cb130-28" tabindex="-1"></a>  </span>
<span id="cb130-29"><a href="10-Intro-a-Shiny-exemples.html#cb130-29" tabindex="-1"></a>    output<span class="sc">$</span>histPlot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb130-30"><a href="10-Intro-a-Shiny-exemples.html#cb130-30" tabindex="-1"></a>      tab_proprio_com <span class="sc">%&gt;%</span>  </span>
<span id="cb130-31"><a href="10-Intro-a-Shiny-exemples.html#cb130-31" tabindex="-1"></a>        <span class="fu">filter</span>(DEPT <span class="sc">==</span> <span class="st">&quot;75&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb130-32"><a href="10-Intro-a-Shiny-exemples.html#cb130-32" tabindex="-1"></a>        <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">aes</span>(<span class="at">x=</span>nb_proprio) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">bins=</span>input<span class="sc">$</span>classes)</span>
<span id="cb130-33"><a href="10-Intro-a-Shiny-exemples.html#cb130-33" tabindex="-1"></a>    })</span>
<span id="cb130-34"><a href="10-Intro-a-Shiny-exemples.html#cb130-34" tabindex="-1"></a>    </span>
<span id="cb130-35"><a href="10-Intro-a-Shiny-exemples.html#cb130-35" tabindex="-1"></a>  }</span>
<span id="cb130-36"><a href="10-Intro-a-Shiny-exemples.html#cb130-36" tabindex="-1"></a>  </span>
<span id="cb130-37"><a href="10-Intro-a-Shiny-exemples.html#cb130-37" tabindex="-1"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span></code></pre></div>
<p>Ensuite, donnons la possibilité à l’utilisateur de choisir le département qu’il veut : il faut pour cela ajouter un widget dans la fonction <strong><code>UI</code></strong> ; comme on ne veut laisser qu’un choix de département à l’utilisateur, on peut utiliser un “Radio buttons” ; on regarde alors quels sont les arguments de la fonction <code>radioButtons()</code>, on voit qu’il faut indiquer les choix possibles donc ici la liste des départements dans <code>choices =</code> et indiquer une valeur par défaut dans <code>selected =</code> ; pour cela, on peut indiquer la variable correspondante <code>choices = tab_proprio$DEPT</code>, mais attention si on laisse comme ceci, on va avoir une répétition de noms des départements comme lorsqu’on ouvre la table, ce qu’on veut c’est uniquement les niveaux… deux possibilités alors : soit créer avant l’appel de la fonction <strong><code>UI</code></strong> une variable avec simplement les niveaux de cette variable ; soit passer par la fonction <code>unique()</code> dans l’argument donné.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="10-Intro-a-Shiny-exemples.html#cb131-1" tabindex="-1"></a><span class="co"># Définition UI et Server de l&#39;application Shiny</span></span>
<span id="cb131-2"><a href="10-Intro-a-Shiny-exemples.html#cb131-2" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb131-3"><a href="10-Intro-a-Shiny-exemples.html#cb131-3" tabindex="-1"></a>  <span class="co"># Titre de l&#39;application</span></span>
<span id="cb131-4"><a href="10-Intro-a-Shiny-exemples.html#cb131-4" tabindex="-1"></a>  <span class="fu">titlePanel</span>(<span class="st">&quot;Nombre de propriétaires agrégé au niveau communal dans Paris et sa petite couronne&quot;</span>),</span>
<span id="cb131-5"><a href="10-Intro-a-Shiny-exemples.html#cb131-5" tabindex="-1"></a>  </span>
<span id="cb131-6"><a href="10-Intro-a-Shiny-exemples.html#cb131-6" tabindex="-1"></a>  <span class="co"># Définition du Widget - ici un slider en vue de construire un histogramme</span></span>
<span id="cb131-7"><a href="10-Intro-a-Shiny-exemples.html#cb131-7" tabindex="-1"></a>  <span class="fu">sidebarLayout</span>(</span>
<span id="cb131-8"><a href="10-Intro-a-Shiny-exemples.html#cb131-8" tabindex="-1"></a>    <span class="fu">sidebarPanel</span>(</span>
<span id="cb131-9"><a href="10-Intro-a-Shiny-exemples.html#cb131-9" tabindex="-1"></a>      <span class="fu">sliderInput</span>(<span class="at">inputId =</span> <span class="st">&quot;classes&quot;</span>,</span>
<span id="cb131-10"><a href="10-Intro-a-Shiny-exemples.html#cb131-10" tabindex="-1"></a>                  <span class="at">label =</span> <span class="st">&quot;Nombres de classes&quot;</span>,</span>
<span id="cb131-11"><a href="10-Intro-a-Shiny-exemples.html#cb131-11" tabindex="-1"></a>                  <span class="at">min =</span> <span class="dv">1</span>,</span>
<span id="cb131-12"><a href="10-Intro-a-Shiny-exemples.html#cb131-12" tabindex="-1"></a>                  <span class="at">max =</span> <span class="dv">50</span>,</span>
<span id="cb131-13"><a href="10-Intro-a-Shiny-exemples.html#cb131-13" tabindex="-1"></a>                  <span class="at">value =</span> <span class="dv">25</span>),</span>
<span id="cb131-14"><a href="10-Intro-a-Shiny-exemples.html#cb131-14" tabindex="-1"></a>      <span class="fu">radioButtons</span>(<span class="at">inputId =</span> <span class="st">&quot;dept&quot;</span>, </span>
<span id="cb131-15"><a href="10-Intro-a-Shiny-exemples.html#cb131-15" tabindex="-1"></a>                   <span class="at">label =</span> <span class="st">&quot;Choix du département&quot;</span>,</span>
<span id="cb131-16"><a href="10-Intro-a-Shiny-exemples.html#cb131-16" tabindex="-1"></a>                   <span class="at">choices =</span> <span class="fu">levels</span>(tab_proprio_com<span class="sc">$</span>DEPT), <span class="co">#ou indiquer unique(tab_proprio_com$DEPT)</span></span>
<span id="cb131-17"><a href="10-Intro-a-Shiny-exemples.html#cb131-17" tabindex="-1"></a>                   <span class="at">selected =</span> <span class="st">&quot;75&quot;</span>),</span>
<span id="cb131-18"><a href="10-Intro-a-Shiny-exemples.html#cb131-18" tabindex="-1"></a>    ),</span>
<span id="cb131-19"><a href="10-Intro-a-Shiny-exemples.html#cb131-19" tabindex="-1"></a>    </span>
<span id="cb131-20"><a href="10-Intro-a-Shiny-exemples.html#cb131-20" tabindex="-1"></a>    <span class="co"># Graphe montré à l&#39;utilisateur</span></span>
<span id="cb131-21"><a href="10-Intro-a-Shiny-exemples.html#cb131-21" tabindex="-1"></a>    <span class="fu">mainPanel</span>(</span>
<span id="cb131-22"><a href="10-Intro-a-Shiny-exemples.html#cb131-22" tabindex="-1"></a>      <span class="fu">plotOutput</span>(<span class="st">&quot;histPlot&quot;</span>)</span>
<span id="cb131-23"><a href="10-Intro-a-Shiny-exemples.html#cb131-23" tabindex="-1"></a>    )</span>
<span id="cb131-24"><a href="10-Intro-a-Shiny-exemples.html#cb131-24" tabindex="-1"></a>  )</span>
<span id="cb131-25"><a href="10-Intro-a-Shiny-exemples.html#cb131-25" tabindex="-1"></a>)</span>
<span id="cb131-26"><a href="10-Intro-a-Shiny-exemples.html#cb131-26" tabindex="-1"></a></span>
<span id="cb131-27"><a href="10-Intro-a-Shiny-exemples.html#cb131-27" tabindex="-1"></a>  server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output) {</span>
<span id="cb131-28"><a href="10-Intro-a-Shiny-exemples.html#cb131-28" tabindex="-1"></a>  </span>
<span id="cb131-29"><a href="10-Intro-a-Shiny-exemples.html#cb131-29" tabindex="-1"></a>    output<span class="sc">$</span>histPlot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb131-30"><a href="10-Intro-a-Shiny-exemples.html#cb131-30" tabindex="-1"></a>      tab_proprio_com <span class="sc">%&gt;%</span>  </span>
<span id="cb131-31"><a href="10-Intro-a-Shiny-exemples.html#cb131-31" tabindex="-1"></a>        <span class="fu">filter</span>(DEPT <span class="sc">==</span> <span class="st">&quot;75&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb131-32"><a href="10-Intro-a-Shiny-exemples.html#cb131-32" tabindex="-1"></a>        <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">aes</span>(<span class="at">x=</span>nb_proprio) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">bins=</span>input<span class="sc">$</span>classes)</span>
<span id="cb131-33"><a href="10-Intro-a-Shiny-exemples.html#cb131-33" tabindex="-1"></a>    })</span>
<span id="cb131-34"><a href="10-Intro-a-Shiny-exemples.html#cb131-34" tabindex="-1"></a>    </span>
<span id="cb131-35"><a href="10-Intro-a-Shiny-exemples.html#cb131-35" tabindex="-1"></a>  }</span>
<span id="cb131-36"><a href="10-Intro-a-Shiny-exemples.html#cb131-36" tabindex="-1"></a>  </span>
<span id="cb131-37"><a href="10-Intro-a-Shiny-exemples.html#cb131-37" tabindex="-1"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span></code></pre></div>
<p>Enfin, là encore, il faut introduire la réactivité et “connecter” la partie <strong><code>UI</code></strong> et la partie <strong><code>server</code></strong>, en remplaçant le nom du département dans le <code>filter(dept == )</code> par le nom de l’<code>inputId</code> indiqué dans notre “radioButtons” :</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="10-Intro-a-Shiny-exemples.html#cb132-1" tabindex="-1"></a><span class="co"># Définition UI et Server de l&#39;application Shiny</span></span>
<span id="cb132-2"><a href="10-Intro-a-Shiny-exemples.html#cb132-2" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb132-3"><a href="10-Intro-a-Shiny-exemples.html#cb132-3" tabindex="-1"></a>  <span class="co"># Titre de l&#39;application</span></span>
<span id="cb132-4"><a href="10-Intro-a-Shiny-exemples.html#cb132-4" tabindex="-1"></a>  <span class="fu">titlePanel</span>(<span class="st">&quot;Nombre de propriétaires agrégé au niveau communal dans Paris et sa petite couronne&quot;</span>),</span>
<span id="cb132-5"><a href="10-Intro-a-Shiny-exemples.html#cb132-5" tabindex="-1"></a>  </span>
<span id="cb132-6"><a href="10-Intro-a-Shiny-exemples.html#cb132-6" tabindex="-1"></a>  <span class="co"># Définition du Widget - ici un slider en vue de construire un histogramme</span></span>
<span id="cb132-7"><a href="10-Intro-a-Shiny-exemples.html#cb132-7" tabindex="-1"></a>  <span class="fu">sidebarLayout</span>(</span>
<span id="cb132-8"><a href="10-Intro-a-Shiny-exemples.html#cb132-8" tabindex="-1"></a>    <span class="fu">sidebarPanel</span>(</span>
<span id="cb132-9"><a href="10-Intro-a-Shiny-exemples.html#cb132-9" tabindex="-1"></a>      <span class="fu">sliderInput</span>(<span class="at">inputId =</span> <span class="st">&quot;classes&quot;</span>,</span>
<span id="cb132-10"><a href="10-Intro-a-Shiny-exemples.html#cb132-10" tabindex="-1"></a>                  <span class="at">label =</span> <span class="st">&quot;Nombres de classes&quot;</span>,</span>
<span id="cb132-11"><a href="10-Intro-a-Shiny-exemples.html#cb132-11" tabindex="-1"></a>                  <span class="at">min =</span> <span class="dv">1</span>,</span>
<span id="cb132-12"><a href="10-Intro-a-Shiny-exemples.html#cb132-12" tabindex="-1"></a>                  <span class="at">max =</span> <span class="dv">50</span>,</span>
<span id="cb132-13"><a href="10-Intro-a-Shiny-exemples.html#cb132-13" tabindex="-1"></a>                  <span class="at">value =</span> <span class="dv">25</span>),</span>
<span id="cb132-14"><a href="10-Intro-a-Shiny-exemples.html#cb132-14" tabindex="-1"></a>      <span class="fu">radioButtons</span>(<span class="at">inputId =</span> <span class="st">&quot;dept&quot;</span>, </span>
<span id="cb132-15"><a href="10-Intro-a-Shiny-exemples.html#cb132-15" tabindex="-1"></a>                   <span class="at">label =</span> <span class="st">&quot;Choix du département&quot;</span>,</span>
<span id="cb132-16"><a href="10-Intro-a-Shiny-exemples.html#cb132-16" tabindex="-1"></a>                   <span class="at">choices =</span> <span class="fu">levels</span>(tab_proprio_com<span class="sc">$</span>DEPT), <span class="co">#ou indiquer unique(tab_proprio_com$DEPT)</span></span>
<span id="cb132-17"><a href="10-Intro-a-Shiny-exemples.html#cb132-17" tabindex="-1"></a>                   <span class="at">selected =</span> <span class="st">&quot;75&quot;</span>),</span>
<span id="cb132-18"><a href="10-Intro-a-Shiny-exemples.html#cb132-18" tabindex="-1"></a>    ),</span>
<span id="cb132-19"><a href="10-Intro-a-Shiny-exemples.html#cb132-19" tabindex="-1"></a>    </span>
<span id="cb132-20"><a href="10-Intro-a-Shiny-exemples.html#cb132-20" tabindex="-1"></a>    <span class="co"># Graphe montré à l&#39;utilisateur</span></span>
<span id="cb132-21"><a href="10-Intro-a-Shiny-exemples.html#cb132-21" tabindex="-1"></a>    <span class="fu">mainPanel</span>(</span>
<span id="cb132-22"><a href="10-Intro-a-Shiny-exemples.html#cb132-22" tabindex="-1"></a>      <span class="fu">plotOutput</span>(<span class="st">&quot;histPlot&quot;</span>)</span>
<span id="cb132-23"><a href="10-Intro-a-Shiny-exemples.html#cb132-23" tabindex="-1"></a>    )</span>
<span id="cb132-24"><a href="10-Intro-a-Shiny-exemples.html#cb132-24" tabindex="-1"></a>  )</span>
<span id="cb132-25"><a href="10-Intro-a-Shiny-exemples.html#cb132-25" tabindex="-1"></a>)</span>
<span id="cb132-26"><a href="10-Intro-a-Shiny-exemples.html#cb132-26" tabindex="-1"></a></span>
<span id="cb132-27"><a href="10-Intro-a-Shiny-exemples.html#cb132-27" tabindex="-1"></a>  server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output) {</span>
<span id="cb132-28"><a href="10-Intro-a-Shiny-exemples.html#cb132-28" tabindex="-1"></a>  </span>
<span id="cb132-29"><a href="10-Intro-a-Shiny-exemples.html#cb132-29" tabindex="-1"></a>    output<span class="sc">$</span>histPlot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb132-30"><a href="10-Intro-a-Shiny-exemples.html#cb132-30" tabindex="-1"></a>      tab_proprio_com <span class="sc">%&gt;%</span>  </span>
<span id="cb132-31"><a href="10-Intro-a-Shiny-exemples.html#cb132-31" tabindex="-1"></a>        <span class="fu">filter</span>(DEPT <span class="sc">==</span> input<span class="sc">$</span>dept) <span class="sc">%&gt;%</span> </span>
<span id="cb132-32"><a href="10-Intro-a-Shiny-exemples.html#cb132-32" tabindex="-1"></a>        <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">aes</span>(<span class="at">x=</span>nb_proprio) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">bins=</span>input<span class="sc">$</span>classes)</span>
<span id="cb132-33"><a href="10-Intro-a-Shiny-exemples.html#cb132-33" tabindex="-1"></a>    })</span>
<span id="cb132-34"><a href="10-Intro-a-Shiny-exemples.html#cb132-34" tabindex="-1"></a>    </span>
<span id="cb132-35"><a href="10-Intro-a-Shiny-exemples.html#cb132-35" tabindex="-1"></a>  }</span>
<span id="cb132-36"><a href="10-Intro-a-Shiny-exemples.html#cb132-36" tabindex="-1"></a>  </span>
<span id="cb132-37"><a href="10-Intro-a-Shiny-exemples.html#cb132-37" tabindex="-1"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span></code></pre></div>
<p>On peut voir que le nombre de classes maximum de 50 n’est absolument pas pertinent pour certains départements qui ont peu de communes, c’est quelque chose qui pourra être modifiée bien sûr ultérieurement.</p>
</div>
<div id="modification-du-graphique-selon-une-variable-au-choix-parmi-deux" class="section level2 hasAnchor" number="10.5">
<h2><span class="header-section-number">10.5</span> Modification du graphique : selon une variable au choix parmi deux<a href="10-Intro-a-Shiny-exemples.html#modification-du-graphique-selon-une-variable-au-choix-parmi-deux" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>On peut maintenant vouloir montrer un graphique (toujours le même histogramme) selon au choix deux variables : soit le nombre de propriétaires, soit le nombre de locataires. Il faut donc créer cette dernière variable de la même façon que précédemment pour les propriétaires, et l’ajouter au tableau précédent (qu’on renommera puisqu’il ne concerne plus les seuls propriétaires…).</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="10-Intro-a-Shiny-exemples.html#cb133-1" tabindex="-1"></a>tab_locataires_com <span class="ot">&lt;-</span> RP_final <span class="sc">%&gt;%</span> </span>
<span id="cb133-2"><a href="10-Intro-a-Shiny-exemples.html#cb133-2" tabindex="-1"></a>              <span class="fu">filter</span>(STOCD <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;21&quot;</span>,<span class="st">&quot;22&quot;</span>,<span class="st">&quot;23&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb133-3"><a href="10-Intro-a-Shiny-exemples.html#cb133-3" tabindex="-1"></a>              <span class="fu">mutate</span>(<span class="at">STOCD=</span><span class="fu">case_when</span>(STOCD <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;21&quot;</span>,<span class="st">&quot;22&quot;</span>,<span class="st">&quot;23&quot;</span>) <span class="sc">~</span> <span class="st">&quot;nb_locataires&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb133-4"><a href="10-Intro-a-Shiny-exemples.html#cb133-4" tabindex="-1"></a>              <span class="fu">somme</span>(<span class="at">var_gpe=</span>COM, <span class="at">nom_var=</span>STOCD) <span class="sc">%&gt;%</span> </span>
<span id="cb133-5"><a href="10-Intro-a-Shiny-exemples.html#cb133-5" tabindex="-1"></a>              <span class="fu">filter</span>(COM<span class="sc">!=</span><span class="st">&quot;ZZZZZ&quot;</span>)</span>
<span id="cb133-6"><a href="10-Intro-a-Shiny-exemples.html#cb133-6" tabindex="-1"></a></span>
<span id="cb133-7"><a href="10-Intro-a-Shiny-exemples.html#cb133-7" tabindex="-1"></a>tab_st_occ <span class="ot">&lt;-</span> tab_proprio_com <span class="sc">%&gt;%</span> </span>
<span id="cb133-8"><a href="10-Intro-a-Shiny-exemples.html#cb133-8" tabindex="-1"></a>  <span class="fu">left_join</span>(tab_locataires_com, <span class="at">by=</span><span class="fu">join_by</span>(<span class="st">&quot;COM&quot;</span>))</span>
<span id="cb133-9"><a href="10-Intro-a-Shiny-exemples.html#cb133-9" tabindex="-1"></a></span>
<span id="cb133-10"><a href="10-Intro-a-Shiny-exemples.html#cb133-10" tabindex="-1"></a><span class="co"># pour supprimer les tables intermédiaires</span></span>
<span id="cb133-11"><a href="10-Intro-a-Shiny-exemples.html#cb133-11" tabindex="-1"></a><span class="fu">rm</span>(tab_locataires_com, tab_proprio_com)</span></code></pre></div>
<p>Procédons comme précédemment : créons un nouveau widget avec par exemple <code>selectInput()</code>, dont l’<code>inputID</code> sera “variable” et l’argument <code>choices =</code> donne les deux variables choisies ; pour cela, on peut utiliser une fonction <code>list()</code> et indiquer le nom des deux variables, soient <code>nb_proprio</code> et <code>nb_locataires</code>.<br />
Et ensuite, dans la fonction <strong>server</strong>, remplaçons <code>x=nb_proprio</code> par <code>x=input$variable</code> et voyons si cela marche !</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="10-Intro-a-Shiny-exemples.html#cb134-1" tabindex="-1"></a><span class="co"># Définition UI et Server de l&#39;application Shiny</span></span>
<span id="cb134-2"><a href="10-Intro-a-Shiny-exemples.html#cb134-2" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb134-3"><a href="10-Intro-a-Shiny-exemples.html#cb134-3" tabindex="-1"></a>  <span class="co"># Titre de l&#39;application</span></span>
<span id="cb134-4"><a href="10-Intro-a-Shiny-exemples.html#cb134-4" tabindex="-1"></a>  <span class="fu">titlePanel</span>(<span class="st">&quot;Statut d&#39;occupation des logements agrégé au niveau communal, selon le département&quot;</span>),</span>
<span id="cb134-5"><a href="10-Intro-a-Shiny-exemples.html#cb134-5" tabindex="-1"></a>  </span>
<span id="cb134-6"><a href="10-Intro-a-Shiny-exemples.html#cb134-6" tabindex="-1"></a>  <span class="co"># Définition du Widget - ici un slider en vue de construire un histogramme</span></span>
<span id="cb134-7"><a href="10-Intro-a-Shiny-exemples.html#cb134-7" tabindex="-1"></a>  <span class="fu">sidebarLayout</span>(</span>
<span id="cb134-8"><a href="10-Intro-a-Shiny-exemples.html#cb134-8" tabindex="-1"></a>    <span class="fu">sidebarPanel</span>(</span>
<span id="cb134-9"><a href="10-Intro-a-Shiny-exemples.html#cb134-9" tabindex="-1"></a>      <span class="fu">sliderInput</span>(<span class="at">inputId =</span> <span class="st">&quot;classes&quot;</span>,</span>
<span id="cb134-10"><a href="10-Intro-a-Shiny-exemples.html#cb134-10" tabindex="-1"></a>                  <span class="at">label =</span> <span class="st">&quot;Nombres de classes&quot;</span>,</span>
<span id="cb134-11"><a href="10-Intro-a-Shiny-exemples.html#cb134-11" tabindex="-1"></a>                  <span class="at">min =</span> <span class="dv">1</span>,</span>
<span id="cb134-12"><a href="10-Intro-a-Shiny-exemples.html#cb134-12" tabindex="-1"></a>                  <span class="at">max =</span> <span class="dv">50</span>,</span>
<span id="cb134-13"><a href="10-Intro-a-Shiny-exemples.html#cb134-13" tabindex="-1"></a>                  <span class="at">value =</span> <span class="dv">25</span>),</span>
<span id="cb134-14"><a href="10-Intro-a-Shiny-exemples.html#cb134-14" tabindex="-1"></a>      <span class="fu">radioButtons</span>(<span class="at">inputId =</span> <span class="st">&quot;dept&quot;</span>, </span>
<span id="cb134-15"><a href="10-Intro-a-Shiny-exemples.html#cb134-15" tabindex="-1"></a>                   <span class="at">label =</span> <span class="st">&quot;Choix du département&quot;</span>,</span>
<span id="cb134-16"><a href="10-Intro-a-Shiny-exemples.html#cb134-16" tabindex="-1"></a>                   <span class="at">choices =</span> <span class="fu">levels</span>(tab_st_occ<span class="sc">$</span>DEPT),</span>
<span id="cb134-17"><a href="10-Intro-a-Shiny-exemples.html#cb134-17" tabindex="-1"></a>                   <span class="at">selected =</span> <span class="st">&quot;75&quot;</span>),</span>
<span id="cb134-18"><a href="10-Intro-a-Shiny-exemples.html#cb134-18" tabindex="-1"></a>      <span class="fu">selectInput</span>(<span class="at">inputId =</span> <span class="st">&quot;variable&quot;</span>, </span>
<span id="cb134-19"><a href="10-Intro-a-Shiny-exemples.html#cb134-19" tabindex="-1"></a>                  <span class="at">label =</span> <span class="st">&quot;Choix de la variable&quot;</span>, </span>
<span id="cb134-20"><a href="10-Intro-a-Shiny-exemples.html#cb134-20" tabindex="-1"></a>                  <span class="at">choices =</span> <span class="fu">list</span>(<span class="st">&quot;nb_proprio&quot;</span>, <span class="st">&quot;nb_locataires&quot;</span>), </span>
<span id="cb134-21"><a href="10-Intro-a-Shiny-exemples.html#cb134-21" tabindex="-1"></a>                  <span class="at">selected =</span> <span class="st">&quot;nb_proprio&quot;</span>),</span>
<span id="cb134-22"><a href="10-Intro-a-Shiny-exemples.html#cb134-22" tabindex="-1"></a>    ),</span>
<span id="cb134-23"><a href="10-Intro-a-Shiny-exemples.html#cb134-23" tabindex="-1"></a>    </span>
<span id="cb134-24"><a href="10-Intro-a-Shiny-exemples.html#cb134-24" tabindex="-1"></a>    <span class="co"># Graphe montré à l&#39;utilisateur</span></span>
<span id="cb134-25"><a href="10-Intro-a-Shiny-exemples.html#cb134-25" tabindex="-1"></a>    <span class="fu">mainPanel</span>(</span>
<span id="cb134-26"><a href="10-Intro-a-Shiny-exemples.html#cb134-26" tabindex="-1"></a>      <span class="fu">plotOutput</span>(<span class="st">&quot;histPlot&quot;</span>)</span>
<span id="cb134-27"><a href="10-Intro-a-Shiny-exemples.html#cb134-27" tabindex="-1"></a>    )</span>
<span id="cb134-28"><a href="10-Intro-a-Shiny-exemples.html#cb134-28" tabindex="-1"></a>  )</span>
<span id="cb134-29"><a href="10-Intro-a-Shiny-exemples.html#cb134-29" tabindex="-1"></a>)</span>
<span id="cb134-30"><a href="10-Intro-a-Shiny-exemples.html#cb134-30" tabindex="-1"></a></span>
<span id="cb134-31"><a href="10-Intro-a-Shiny-exemples.html#cb134-31" tabindex="-1"></a>  server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output) {</span>
<span id="cb134-32"><a href="10-Intro-a-Shiny-exemples.html#cb134-32" tabindex="-1"></a>  </span>
<span id="cb134-33"><a href="10-Intro-a-Shiny-exemples.html#cb134-33" tabindex="-1"></a>    output<span class="sc">$</span>histPlot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb134-34"><a href="10-Intro-a-Shiny-exemples.html#cb134-34" tabindex="-1"></a>      tab_st_occ <span class="sc">%&gt;%</span>  </span>
<span id="cb134-35"><a href="10-Intro-a-Shiny-exemples.html#cb134-35" tabindex="-1"></a>        <span class="fu">filter</span>(DEPT <span class="sc">==</span> input<span class="sc">$</span>dept) <span class="sc">%&gt;%</span> </span>
<span id="cb134-36"><a href="10-Intro-a-Shiny-exemples.html#cb134-36" tabindex="-1"></a>        <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">aes</span>(<span class="at">x=</span>input<span class="sc">$</span>variable) <span class="sc">+</span> </span>
<span id="cb134-37"><a href="10-Intro-a-Shiny-exemples.html#cb134-37" tabindex="-1"></a>                   <span class="fu">geom_histogram</span>(<span class="at">bins=</span>input<span class="sc">$</span>classes)</span>
<span id="cb134-38"><a href="10-Intro-a-Shiny-exemples.html#cb134-38" tabindex="-1"></a>    })</span>
<span id="cb134-39"><a href="10-Intro-a-Shiny-exemples.html#cb134-39" tabindex="-1"></a>    </span>
<span id="cb134-40"><a href="10-Intro-a-Shiny-exemples.html#cb134-40" tabindex="-1"></a>  }</span>
<span id="cb134-41"><a href="10-Intro-a-Shiny-exemples.html#cb134-41" tabindex="-1"></a>  </span>
<span id="cb134-42"><a href="10-Intro-a-Shiny-exemples.html#cb134-42" tabindex="-1"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span></code></pre></div>
<p>Et non cela ne fonctionne pas. En réalité, comme nous avons utilisé dans <code>choices =</code> une fonction <code>list()</code> qui fait appel à des variables de type caractère, la fonction <code>ggplot() + aes(x = )</code> ne comprend pas que la variable appelée est bien une variable numérique (son contenu), elle croît en quelque sorte que c’est une variable caractère. Il faut donc dire à la fonction <code>ggplot()</code> ici que le nom de la variable est de type “string” mais qu’elle comporte bien des valeurs numériques donc compatible avec un histogramme : pour cela, au lieu de <code>ggplot() + aes(x = )</code>, il faut utiliser <code>ggplot() + aes_string(x = )</code>.</p>
<p>Réessayons :</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="10-Intro-a-Shiny-exemples.html#cb135-1" tabindex="-1"></a><span class="co"># Définition UI et Server de l&#39;application Shiny</span></span>
<span id="cb135-2"><a href="10-Intro-a-Shiny-exemples.html#cb135-2" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb135-3"><a href="10-Intro-a-Shiny-exemples.html#cb135-3" tabindex="-1"></a>  <span class="co"># Titre de l&#39;application</span></span>
<span id="cb135-4"><a href="10-Intro-a-Shiny-exemples.html#cb135-4" tabindex="-1"></a>  <span class="fu">titlePanel</span>(<span class="st">&quot;Statut d&#39;occupation des logements agrégé au niveau communal, selon le département&quot;</span>),</span>
<span id="cb135-5"><a href="10-Intro-a-Shiny-exemples.html#cb135-5" tabindex="-1"></a>  </span>
<span id="cb135-6"><a href="10-Intro-a-Shiny-exemples.html#cb135-6" tabindex="-1"></a>  <span class="co"># Définition du Widget - ici un slider en vue de construire un histogramme</span></span>
<span id="cb135-7"><a href="10-Intro-a-Shiny-exemples.html#cb135-7" tabindex="-1"></a>  <span class="fu">sidebarLayout</span>(</span>
<span id="cb135-8"><a href="10-Intro-a-Shiny-exemples.html#cb135-8" tabindex="-1"></a>    <span class="fu">sidebarPanel</span>(</span>
<span id="cb135-9"><a href="10-Intro-a-Shiny-exemples.html#cb135-9" tabindex="-1"></a>      <span class="fu">sliderInput</span>(<span class="at">inputId =</span> <span class="st">&quot;classes&quot;</span>,</span>
<span id="cb135-10"><a href="10-Intro-a-Shiny-exemples.html#cb135-10" tabindex="-1"></a>                  <span class="at">label =</span> <span class="st">&quot;Nombres de classes&quot;</span>,</span>
<span id="cb135-11"><a href="10-Intro-a-Shiny-exemples.html#cb135-11" tabindex="-1"></a>                  <span class="at">min =</span> <span class="dv">1</span>,</span>
<span id="cb135-12"><a href="10-Intro-a-Shiny-exemples.html#cb135-12" tabindex="-1"></a>                  <span class="at">max =</span> <span class="dv">50</span>,</span>
<span id="cb135-13"><a href="10-Intro-a-Shiny-exemples.html#cb135-13" tabindex="-1"></a>                  <span class="at">value =</span> <span class="dv">25</span>),</span>
<span id="cb135-14"><a href="10-Intro-a-Shiny-exemples.html#cb135-14" tabindex="-1"></a>      <span class="fu">radioButtons</span>(<span class="at">inputId =</span> <span class="st">&quot;dept&quot;</span>, </span>
<span id="cb135-15"><a href="10-Intro-a-Shiny-exemples.html#cb135-15" tabindex="-1"></a>                   <span class="at">label =</span> <span class="st">&quot;Choix du département&quot;</span>,</span>
<span id="cb135-16"><a href="10-Intro-a-Shiny-exemples.html#cb135-16" tabindex="-1"></a>                   <span class="at">choices =</span> <span class="fu">unique</span>(tab_st_occ<span class="sc">$</span>DEPT),</span>
<span id="cb135-17"><a href="10-Intro-a-Shiny-exemples.html#cb135-17" tabindex="-1"></a>                   <span class="at">selected =</span> <span class="st">&quot;75&quot;</span>),</span>
<span id="cb135-18"><a href="10-Intro-a-Shiny-exemples.html#cb135-18" tabindex="-1"></a>      <span class="fu">selectInput</span>(<span class="at">inputId =</span> <span class="st">&quot;variable&quot;</span>, </span>
<span id="cb135-19"><a href="10-Intro-a-Shiny-exemples.html#cb135-19" tabindex="-1"></a>                  <span class="at">label =</span> <span class="st">&quot;Choix de la variable&quot;</span>, </span>
<span id="cb135-20"><a href="10-Intro-a-Shiny-exemples.html#cb135-20" tabindex="-1"></a>                  <span class="at">choices =</span> <span class="fu">list</span>(<span class="st">&quot;nb_proprio&quot;</span>, <span class="st">&quot;nb_locataires&quot;</span>), </span>
<span id="cb135-21"><a href="10-Intro-a-Shiny-exemples.html#cb135-21" tabindex="-1"></a>                  <span class="at">selected =</span> <span class="st">&quot;nb_proprio&quot;</span>),</span>
<span id="cb135-22"><a href="10-Intro-a-Shiny-exemples.html#cb135-22" tabindex="-1"></a>    ),</span>
<span id="cb135-23"><a href="10-Intro-a-Shiny-exemples.html#cb135-23" tabindex="-1"></a>    </span>
<span id="cb135-24"><a href="10-Intro-a-Shiny-exemples.html#cb135-24" tabindex="-1"></a>    <span class="co"># Graphe montré à l&#39;utilisateur</span></span>
<span id="cb135-25"><a href="10-Intro-a-Shiny-exemples.html#cb135-25" tabindex="-1"></a>    <span class="fu">mainPanel</span>(</span>
<span id="cb135-26"><a href="10-Intro-a-Shiny-exemples.html#cb135-26" tabindex="-1"></a>      <span class="fu">plotOutput</span>(<span class="st">&quot;histPlot&quot;</span>)</span>
<span id="cb135-27"><a href="10-Intro-a-Shiny-exemples.html#cb135-27" tabindex="-1"></a>    )</span>
<span id="cb135-28"><a href="10-Intro-a-Shiny-exemples.html#cb135-28" tabindex="-1"></a>  )</span>
<span id="cb135-29"><a href="10-Intro-a-Shiny-exemples.html#cb135-29" tabindex="-1"></a>)</span>
<span id="cb135-30"><a href="10-Intro-a-Shiny-exemples.html#cb135-30" tabindex="-1"></a></span>
<span id="cb135-31"><a href="10-Intro-a-Shiny-exemples.html#cb135-31" tabindex="-1"></a>  server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output) {</span>
<span id="cb135-32"><a href="10-Intro-a-Shiny-exemples.html#cb135-32" tabindex="-1"></a>  </span>
<span id="cb135-33"><a href="10-Intro-a-Shiny-exemples.html#cb135-33" tabindex="-1"></a>    output<span class="sc">$</span>histPlot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb135-34"><a href="10-Intro-a-Shiny-exemples.html#cb135-34" tabindex="-1"></a>      tab_st_occ <span class="sc">%&gt;%</span>  </span>
<span id="cb135-35"><a href="10-Intro-a-Shiny-exemples.html#cb135-35" tabindex="-1"></a>        <span class="fu">filter</span>(DEPT <span class="sc">==</span> input<span class="sc">$</span>dept) <span class="sc">%&gt;%</span> </span>
<span id="cb135-36"><a href="10-Intro-a-Shiny-exemples.html#cb135-36" tabindex="-1"></a>        <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">aes_string</span>(<span class="at">x=</span>input<span class="sc">$</span>variable) <span class="sc">+</span> </span>
<span id="cb135-37"><a href="10-Intro-a-Shiny-exemples.html#cb135-37" tabindex="-1"></a>                   <span class="fu">geom_histogram</span>(<span class="at">bins=</span>input<span class="sc">$</span>classes)</span>
<span id="cb135-38"><a href="10-Intro-a-Shiny-exemples.html#cb135-38" tabindex="-1"></a>    })</span>
<span id="cb135-39"><a href="10-Intro-a-Shiny-exemples.html#cb135-39" tabindex="-1"></a>    </span>
<span id="cb135-40"><a href="10-Intro-a-Shiny-exemples.html#cb135-40" tabindex="-1"></a>  }</span>
<span id="cb135-41"><a href="10-Intro-a-Shiny-exemples.html#cb135-41" tabindex="-1"></a>  </span>
<span id="cb135-42"><a href="10-Intro-a-Shiny-exemples.html#cb135-42" tabindex="-1"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span></code></pre></div>
<p>Enfin, on peut ajouter en-dessous de l’histogramme un autre graphique, en l’occurence une boîte à moustache, et introduire une réactivité sur la base de données, ce qui permet un gain d’efficacité (en particulier en cas de base de données volumineuse) et ici d’éviter de réécrire deux fois le filtre dans les deux fonctions créant les deux graphiques :</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="10-Intro-a-Shiny-exemples.html#cb136-1" tabindex="-1"></a><span class="co"># Définition UI et Server de l&#39;application Shiny</span></span>
<span id="cb136-2"><a href="10-Intro-a-Shiny-exemples.html#cb136-2" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb136-3"><a href="10-Intro-a-Shiny-exemples.html#cb136-3" tabindex="-1"></a>  <span class="co"># Titre de l&#39;application</span></span>
<span id="cb136-4"><a href="10-Intro-a-Shiny-exemples.html#cb136-4" tabindex="-1"></a>  <span class="fu">titlePanel</span>(<span class="st">&quot;Statut d&#39;occupation des logements au niveau communal, selon le département&quot;</span>),</span>
<span id="cb136-5"><a href="10-Intro-a-Shiny-exemples.html#cb136-5" tabindex="-1"></a>  </span>
<span id="cb136-6"><a href="10-Intro-a-Shiny-exemples.html#cb136-6" tabindex="-1"></a>  <span class="co"># Définition du Widget - ici un slider en vue de construire un histogramme</span></span>
<span id="cb136-7"><a href="10-Intro-a-Shiny-exemples.html#cb136-7" tabindex="-1"></a>  <span class="fu">sidebarLayout</span>(</span>
<span id="cb136-8"><a href="10-Intro-a-Shiny-exemples.html#cb136-8" tabindex="-1"></a>    <span class="fu">sidebarPanel</span>(</span>
<span id="cb136-9"><a href="10-Intro-a-Shiny-exemples.html#cb136-9" tabindex="-1"></a>      <span class="fu">sliderInput</span>(<span class="at">inputId =</span> <span class="st">&quot;classes&quot;</span>,</span>
<span id="cb136-10"><a href="10-Intro-a-Shiny-exemples.html#cb136-10" tabindex="-1"></a>                  <span class="at">label =</span> <span class="st">&quot;Nombres de classes pour l&#39;histogramme&quot;</span>,</span>
<span id="cb136-11"><a href="10-Intro-a-Shiny-exemples.html#cb136-11" tabindex="-1"></a>                  <span class="at">min =</span> <span class="dv">1</span>,</span>
<span id="cb136-12"><a href="10-Intro-a-Shiny-exemples.html#cb136-12" tabindex="-1"></a>                  <span class="at">max =</span> <span class="dv">50</span>,</span>
<span id="cb136-13"><a href="10-Intro-a-Shiny-exemples.html#cb136-13" tabindex="-1"></a>                  <span class="at">value =</span> <span class="dv">25</span>),</span>
<span id="cb136-14"><a href="10-Intro-a-Shiny-exemples.html#cb136-14" tabindex="-1"></a>      <span class="fu">radioButtons</span>(<span class="at">inputId =</span> <span class="st">&quot;dept&quot;</span>, </span>
<span id="cb136-15"><a href="10-Intro-a-Shiny-exemples.html#cb136-15" tabindex="-1"></a>                   <span class="at">label =</span> <span class="st">&quot;Choix du département&quot;</span>,</span>
<span id="cb136-16"><a href="10-Intro-a-Shiny-exemples.html#cb136-16" tabindex="-1"></a>                   <span class="at">choices =</span> <span class="fu">unique</span>(tab_st_occ<span class="sc">$</span>DEPT), <span class="co">#ou indiquer &#39;nom_dept&#39;</span></span>
<span id="cb136-17"><a href="10-Intro-a-Shiny-exemples.html#cb136-17" tabindex="-1"></a>                   <span class="at">selected =</span> <span class="st">&quot;75&quot;</span>),</span>
<span id="cb136-18"><a href="10-Intro-a-Shiny-exemples.html#cb136-18" tabindex="-1"></a>      <span class="fu">selectInput</span>(<span class="at">inputId =</span> <span class="st">&quot;variable&quot;</span>, </span>
<span id="cb136-19"><a href="10-Intro-a-Shiny-exemples.html#cb136-19" tabindex="-1"></a>                  <span class="at">label =</span> <span class="st">&quot;Choix de la variable&quot;</span>, </span>
<span id="cb136-20"><a href="10-Intro-a-Shiny-exemples.html#cb136-20" tabindex="-1"></a>                  <span class="at">choices =</span> <span class="fu">list</span>(<span class="st">&quot;nb_proprio&quot;</span>, <span class="st">&quot;nb_locataires&quot;</span>), </span>
<span id="cb136-21"><a href="10-Intro-a-Shiny-exemples.html#cb136-21" tabindex="-1"></a>                  <span class="at">selected =</span> <span class="st">&quot;nb_proprio&quot;</span>),</span>
<span id="cb136-22"><a href="10-Intro-a-Shiny-exemples.html#cb136-22" tabindex="-1"></a>    ),</span>
<span id="cb136-23"><a href="10-Intro-a-Shiny-exemples.html#cb136-23" tabindex="-1"></a>    </span>
<span id="cb136-24"><a href="10-Intro-a-Shiny-exemples.html#cb136-24" tabindex="-1"></a>    <span class="co"># Graphe montré à l&#39;utilisateur</span></span>
<span id="cb136-25"><a href="10-Intro-a-Shiny-exemples.html#cb136-25" tabindex="-1"></a>    <span class="fu">mainPanel</span>(</span>
<span id="cb136-26"><a href="10-Intro-a-Shiny-exemples.html#cb136-26" tabindex="-1"></a>      <span class="fu">plotOutput</span>(<span class="st">&quot;histPlot&quot;</span>),</span>
<span id="cb136-27"><a href="10-Intro-a-Shiny-exemples.html#cb136-27" tabindex="-1"></a>      <span class="fu">plotOutput</span>(<span class="st">&quot;boxPlot&quot;</span>)</span>
<span id="cb136-28"><a href="10-Intro-a-Shiny-exemples.html#cb136-28" tabindex="-1"></a>    )</span>
<span id="cb136-29"><a href="10-Intro-a-Shiny-exemples.html#cb136-29" tabindex="-1"></a>  )</span>
<span id="cb136-30"><a href="10-Intro-a-Shiny-exemples.html#cb136-30" tabindex="-1"></a>)</span>
<span id="cb136-31"><a href="10-Intro-a-Shiny-exemples.html#cb136-31" tabindex="-1"></a></span>
<span id="cb136-32"><a href="10-Intro-a-Shiny-exemples.html#cb136-32" tabindex="-1"></a>  server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output) {</span>
<span id="cb136-33"><a href="10-Intro-a-Shiny-exemples.html#cb136-33" tabindex="-1"></a>    </span>
<span id="cb136-34"><a href="10-Intro-a-Shiny-exemples.html#cb136-34" tabindex="-1"></a>    <span class="co"># Base réactive</span></span>
<span id="cb136-35"><a href="10-Intro-a-Shiny-exemples.html#cb136-35" tabindex="-1"></a>    tab_st_occ_react <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb136-36"><a href="10-Intro-a-Shiny-exemples.html#cb136-36" tabindex="-1"></a>      tab_st_occ <span class="sc">%&gt;%</span>  </span>
<span id="cb136-37"><a href="10-Intro-a-Shiny-exemples.html#cb136-37" tabindex="-1"></a>      <span class="fu">filter</span>(DEPT <span class="sc">==</span> input<span class="sc">$</span>dept)</span>
<span id="cb136-38"><a href="10-Intro-a-Shiny-exemples.html#cb136-38" tabindex="-1"></a>    })</span>
<span id="cb136-39"><a href="10-Intro-a-Shiny-exemples.html#cb136-39" tabindex="-1"></a>    </span>
<span id="cb136-40"><a href="10-Intro-a-Shiny-exemples.html#cb136-40" tabindex="-1"></a>    output<span class="sc">$</span>histPlot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb136-41"><a href="10-Intro-a-Shiny-exemples.html#cb136-41" tabindex="-1"></a>      <span class="fu">tab_st_occ_react</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb136-42"><a href="10-Intro-a-Shiny-exemples.html#cb136-42" tabindex="-1"></a>        <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">aes_string</span>(<span class="at">x=</span>input<span class="sc">$</span>variable) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">bins=</span>input<span class="sc">$</span>classes)</span>
<span id="cb136-43"><a href="10-Intro-a-Shiny-exemples.html#cb136-43" tabindex="-1"></a>      </span>
<span id="cb136-44"><a href="10-Intro-a-Shiny-exemples.html#cb136-44" tabindex="-1"></a>    })</span>
<span id="cb136-45"><a href="10-Intro-a-Shiny-exemples.html#cb136-45" tabindex="-1"></a>    </span>
<span id="cb136-46"><a href="10-Intro-a-Shiny-exemples.html#cb136-46" tabindex="-1"></a>    output<span class="sc">$</span>boxPlot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb136-47"><a href="10-Intro-a-Shiny-exemples.html#cb136-47" tabindex="-1"></a>      <span class="fu">tab_st_occ_react</span>() <span class="sc">%&gt;%</span>  </span>
<span id="cb136-48"><a href="10-Intro-a-Shiny-exemples.html#cb136-48" tabindex="-1"></a>        <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">aes_string</span>(<span class="at">y =</span> input<span class="sc">$</span>variable) <span class="sc">+</span> </span>
<span id="cb136-49"><a href="10-Intro-a-Shiny-exemples.html#cb136-49" tabindex="-1"></a>        <span class="fu">geom_boxplot</span>() <span class="sc">+</span> <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb136-50"><a href="10-Intro-a-Shiny-exemples.html#cb136-50" tabindex="-1"></a>        <span class="fu">scale_y_continuous</span>(<span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">quantile</span>(<span class="fu">tab_st_occ_react</span>()[[input<span class="sc">$</span>variable]], <span class="fl">0.75</span>)<span class="sc">*</span><span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb136-51"><a href="10-Intro-a-Shiny-exemples.html#cb136-51" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">caption=</span><span class="st">&quot;Rq : les valeurs supérieures à 2 fois le Q3 de la distribution ne sont pas affichées sur le graphique&quot;</span>, <span class="at">x=</span><span class="st">&quot;&quot;</span>, <span class="at">y=</span><span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb136-52"><a href="10-Intro-a-Shiny-exemples.html#cb136-52" tabindex="-1"></a>        <span class="fu">theme</span>(<span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span><span class="dv">0</span>, <span class="at">size=</span><span class="fl">11.5</span>))</span>
<span id="cb136-53"><a href="10-Intro-a-Shiny-exemples.html#cb136-53" tabindex="-1"></a>    })</span>
<span id="cb136-54"><a href="10-Intro-a-Shiny-exemples.html#cb136-54" tabindex="-1"></a>    </span>
<span id="cb136-55"><a href="10-Intro-a-Shiny-exemples.html#cb136-55" tabindex="-1"></a>  }</span>
<span id="cb136-56"><a href="10-Intro-a-Shiny-exemples.html#cb136-56" tabindex="-1"></a>  </span>
<span id="cb136-57"><a href="10-Intro-a-Shiny-exemples.html#cb136-57" tabindex="-1"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span></code></pre></div>
</div>
</div>
<div id="applications-plus-poussées-sur-shiny" class="section level1 hasAnchor" number="11">
<h1><span class="header-section-number">Section 11</span> Applications plus poussées sur Shiny<a href="10-Intro-a-Shiny-exemples.html#applications-plus-poussées-sur-shiny" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="application-avec-un-tableau-et-un-graphique-sur-une-autre-base-de-données" class="section level2 hasAnchor" number="11.1">
<h2><span class="header-section-number">11.1</span> Application avec un tableau et un graphique sur une autre base de données<a href="10-Intro-a-Shiny-exemples.html#application-avec-un-tableau-et-un-graphique-sur-une-autre-base-de-données" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>En repartant de la base DVF des ventes d’appartements à Paris entre 2019 et 2022, on va créer une autre application en mettant en haut un tableau général récapitulant pour Paris et sur la période d’ensemble les informations suivantes : le prix moyen et médian au m2, le nombre moyen de pièces et le nombre de ventes ; puis en-dessous de ce tableau, on va ajouter un graphique (barplot) qui va représenter le “top 5” du prix médian au m2 des ventes d’appartements selon le nombre de pièces et selon l’arrondissement.<br />
Pour avoir des chiffres plus près de la réalité par rapport aux graphiques réalisées dans les sections précédentes sur cette base de données, on ne va prendre que les observations qui correspondent à une vente unique (<code>id_mutation</code> et <code>id_parcelle</code> différente pour chaque observation/ligne) ; on va utiliser pour cela la fonction <code>add_count()</code>.</p>
<p>Ainsi, le premier tableau ne sera pas à ce stade réactif, alors que le graphique le sera. Il y aura par conséquent deux widgets, l’un pour choisir l’année considérée et l’autre pour choisir le nombre de pièces des logements.
Pour le tableau, vous pouvez utiliser le package <strong><code>gt()</code></strong> et la fonction <code>gt_output()</code> pour l’appel du tableau dans la partie <strong>UI</strong> associée à la fonction <code>render_gt()</code> dans la partie <strong>server</strong>.</p>
<p>Cela doit vous donner ceci :
<img src="images/Ex.1_Shiny.png" /></p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="10-Intro-a-Shiny-exemples.html#cb137-1" tabindex="-1"></a><span class="co"># Chargement des librairies</span></span>
<span id="cb137-2"><a href="10-Intro-a-Shiny-exemples.html#cb137-2" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb137-3"><a href="10-Intro-a-Shiny-exemples.html#cb137-3" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb137-4"><a href="10-Intro-a-Shiny-exemples.html#cb137-4" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb137-5"><a href="10-Intro-a-Shiny-exemples.html#cb137-5" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb137-6"><a href="10-Intro-a-Shiny-exemples.html#cb137-6" tabindex="-1"></a><span class="fu">library</span>(forcats)</span>
<span id="cb137-7"><a href="10-Intro-a-Shiny-exemples.html#cb137-7" tabindex="-1"></a></span>
<span id="cb137-8"><a href="10-Intro-a-Shiny-exemples.html#cb137-8" tabindex="-1"></a></span>
<span id="cb137-9"><a href="10-Intro-a-Shiny-exemples.html#cb137-9" tabindex="-1"></a><span class="co"># Chargement du fichier</span></span>
<span id="cb137-10"><a href="10-Intro-a-Shiny-exemples.html#cb137-10" tabindex="-1"></a>dvf_Paris_1 <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data/dvf_Paris_1.Rdata&quot;</span>)</span>
<span id="cb137-11"><a href="10-Intro-a-Shiny-exemples.html#cb137-11" tabindex="-1"></a></span>
<span id="cb137-12"><a href="10-Intro-a-Shiny-exemples.html#cb137-12" tabindex="-1"></a><span class="co"># Création de la variable catégories de nombre de pièces et mise en factor de la variable du nom d&#39;arrondissement</span></span>
<span id="cb137-13"><a href="10-Intro-a-Shiny-exemples.html#cb137-13" tabindex="-1"></a>dvf_Paris_1 <span class="ot">&lt;-</span> dvf_Paris_1 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(nom_arrdt <span class="sc">!=</span> <span class="st">&quot;NA&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb137-14"><a href="10-Intro-a-Shiny-exemples.html#cb137-14" tabindex="-1"></a>                 <span class="fu">mutate</span>(<span class="at">nbpieces_cat=</span><span class="fu">as.factor</span>(<span class="fu">case_when</span>(nombre_pieces_principales<span class="sc">==</span><span class="dv">1</span> <span class="sc">~</span> <span class="st">&#39;Une pièce&#39;</span>, </span>
<span id="cb137-15"><a href="10-Intro-a-Shiny-exemples.html#cb137-15" tabindex="-1"></a>                                                         nombre_pieces_principales<span class="sc">==</span><span class="dv">2</span> <span class="sc">~</span> <span class="st">&#39;Deux pièces&#39;</span>,</span>
<span id="cb137-16"><a href="10-Intro-a-Shiny-exemples.html#cb137-16" tabindex="-1"></a>                                                         nombre_pieces_principales<span class="sc">&gt;=</span><span class="dv">3</span> <span class="sc">~</span> <span class="st">&#39;Trois pièces ou plus&#39;</span>)),</span>
<span id="cb137-17"><a href="10-Intro-a-Shiny-exemples.html#cb137-17" tabindex="-1"></a>                        <span class="at">nbpieces_cat=</span><span class="fu">factor</span>(nbpieces_cat, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">&#39;Une pièce&#39;</span>, <span class="st">&#39;Deux pièces&#39;</span>, <span class="st">&#39;Trois pièces ou plus&#39;</span>)),</span>
<span id="cb137-18"><a href="10-Intro-a-Shiny-exemples.html#cb137-18" tabindex="-1"></a>                        <span class="at">annee=</span><span class="fu">as.factor</span>(annee)) <span class="sc">%&gt;%</span> </span>
<span id="cb137-19"><a href="10-Intro-a-Shiny-exemples.html#cb137-19" tabindex="-1"></a>  <span class="fu">add_count</span>(id_mutation, id_parcelle, annee, surface_reelle_bati)</span>
<span id="cb137-20"><a href="10-Intro-a-Shiny-exemples.html#cb137-20" tabindex="-1"></a></span>
<span id="cb137-21"><a href="10-Intro-a-Shiny-exemples.html#cb137-21" tabindex="-1"></a></span>
<span id="cb137-22"><a href="10-Intro-a-Shiny-exemples.html#cb137-22" tabindex="-1"></a><span class="co"># Définition UI et Server de l&#39;application Shiny</span></span>
<span id="cb137-23"><a href="10-Intro-a-Shiny-exemples.html#cb137-23" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb137-24"><a href="10-Intro-a-Shiny-exemples.html#cb137-24" tabindex="-1"></a>  <span class="co"># Titre de l&#39;application</span></span>
<span id="cb137-25"><a href="10-Intro-a-Shiny-exemples.html#cb137-25" tabindex="-1"></a>  <span class="fu">titlePanel</span>(<span class="st">&quot;Caractéristiques des ventes d&#39;appartements dans Paris sur la période 2019-2022&quot;</span>),</span>
<span id="cb137-26"><a href="10-Intro-a-Shiny-exemples.html#cb137-26" tabindex="-1"></a>  </span>
<span id="cb137-27"><a href="10-Intro-a-Shiny-exemples.html#cb137-27" tabindex="-1"></a>  <span class="fu">br</span>(),</span>
<span id="cb137-28"><a href="10-Intro-a-Shiny-exemples.html#cb137-28" tabindex="-1"></a>  </span>
<span id="cb137-29"><a href="10-Intro-a-Shiny-exemples.html#cb137-29" tabindex="-1"></a>  <span class="co"># Définition du Widget</span></span>
<span id="cb137-30"><a href="10-Intro-a-Shiny-exemples.html#cb137-30" tabindex="-1"></a>  <span class="fu">sidebarLayout</span>(</span>
<span id="cb137-31"><a href="10-Intro-a-Shiny-exemples.html#cb137-31" tabindex="-1"></a>    <span class="fu">sidebarPanel</span>(</span>
<span id="cb137-32"><a href="10-Intro-a-Shiny-exemples.html#cb137-32" tabindex="-1"></a>      <span class="fu">selectInput</span>(<span class="at">inputId =</span> <span class="st">&quot;annee&quot;</span>, </span>
<span id="cb137-33"><a href="10-Intro-a-Shiny-exemples.html#cb137-33" tabindex="-1"></a>                  <span class="at">label =</span> <span class="st">&quot;Choix de l&#39;année de vente&quot;</span>, </span>
<span id="cb137-34"><a href="10-Intro-a-Shiny-exemples.html#cb137-34" tabindex="-1"></a>                  <span class="at">choices =</span> <span class="fu">list</span>(<span class="st">&quot;2019&quot;</span>, <span class="st">&quot;2020&quot;</span>, <span class="st">&quot;2021&quot;</span>,<span class="st">&quot;2022&quot;</span>),</span>
<span id="cb137-35"><a href="10-Intro-a-Shiny-exemples.html#cb137-35" tabindex="-1"></a>                  <span class="at">selected =</span> <span class="st">&quot;2019&quot;</span>),</span>
<span id="cb137-36"><a href="10-Intro-a-Shiny-exemples.html#cb137-36" tabindex="-1"></a>      <span class="fu">radioButtons</span>(<span class="at">inputId =</span> <span class="st">&quot;nb_pieces&quot;</span>, </span>
<span id="cb137-37"><a href="10-Intro-a-Shiny-exemples.html#cb137-37" tabindex="-1"></a>                   <span class="at">label =</span> <span class="st">&quot;Choix du nombre de pièces&quot;</span>,</span>
<span id="cb137-38"><a href="10-Intro-a-Shiny-exemples.html#cb137-38" tabindex="-1"></a>                   <span class="at">choices =</span> <span class="fu">levels</span>(dvf_Paris_1<span class="sc">$</span>nbpieces_cat),</span>
<span id="cb137-39"><a href="10-Intro-a-Shiny-exemples.html#cb137-39" tabindex="-1"></a>                   <span class="at">selected =</span> <span class="st">&quot;Deux pièces&quot;</span>)</span>
<span id="cb137-40"><a href="10-Intro-a-Shiny-exemples.html#cb137-40" tabindex="-1"></a></span>
<span id="cb137-41"><a href="10-Intro-a-Shiny-exemples.html#cb137-41" tabindex="-1"></a>      ),</span>
<span id="cb137-42"><a href="10-Intro-a-Shiny-exemples.html#cb137-42" tabindex="-1"></a>    </span>
<span id="cb137-43"><a href="10-Intro-a-Shiny-exemples.html#cb137-43" tabindex="-1"></a>    <span class="co"># Tableau et graphe montré à l&#39;utilisateur</span></span>
<span id="cb137-44"><a href="10-Intro-a-Shiny-exemples.html#cb137-44" tabindex="-1"></a>    <span class="fu">mainPanel</span>(</span>
<span id="cb137-45"><a href="10-Intro-a-Shiny-exemples.html#cb137-45" tabindex="-1"></a>      <span class="fu">gt_output</span>(<span class="st">&quot;tab&quot;</span>),</span>
<span id="cb137-46"><a href="10-Intro-a-Shiny-exemples.html#cb137-46" tabindex="-1"></a></span>
<span id="cb137-47"><a href="10-Intro-a-Shiny-exemples.html#cb137-47" tabindex="-1"></a>      <span class="fu">br</span>(),</span>
<span id="cb137-48"><a href="10-Intro-a-Shiny-exemples.html#cb137-48" tabindex="-1"></a>      <span class="fu">br</span>(),</span>
<span id="cb137-49"><a href="10-Intro-a-Shiny-exemples.html#cb137-49" tabindex="-1"></a>      </span>
<span id="cb137-50"><a href="10-Intro-a-Shiny-exemples.html#cb137-50" tabindex="-1"></a>      <span class="fu">plotOutput</span>(<span class="st">&quot;barplot&quot;</span>)    </span>
<span id="cb137-51"><a href="10-Intro-a-Shiny-exemples.html#cb137-51" tabindex="-1"></a>    )</span>
<span id="cb137-52"><a href="10-Intro-a-Shiny-exemples.html#cb137-52" tabindex="-1"></a>  )</span>
<span id="cb137-53"><a href="10-Intro-a-Shiny-exemples.html#cb137-53" tabindex="-1"></a>)</span>
<span id="cb137-54"><a href="10-Intro-a-Shiny-exemples.html#cb137-54" tabindex="-1"></a></span>
<span id="cb137-55"><a href="10-Intro-a-Shiny-exemples.html#cb137-55" tabindex="-1"></a></span>
<span id="cb137-56"><a href="10-Intro-a-Shiny-exemples.html#cb137-56" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output) {</span>
<span id="cb137-57"><a href="10-Intro-a-Shiny-exemples.html#cb137-57" tabindex="-1"></a>  </span>
<span id="cb137-58"><a href="10-Intro-a-Shiny-exemples.html#cb137-58" tabindex="-1"></a>  output<span class="sc">$</span>tab <span class="ot">&lt;-</span> <span class="fu">render_gt</span>({</span>
<span id="cb137-59"><a href="10-Intro-a-Shiny-exemples.html#cb137-59" tabindex="-1"></a>    dvf_Paris_1 <span class="sc">%&gt;%</span> </span>
<span id="cb137-60"><a href="10-Intro-a-Shiny-exemples.html#cb137-60" tabindex="-1"></a>      <span class="fu">filter</span>(n<span class="sc">==</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb137-61"><a href="10-Intro-a-Shiny-exemples.html#cb137-61" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="st">&quot;Nombre de ventes d&#39;appartements&quot;</span> <span class="ot">=</span> <span class="fu">sum</span>(nombre_lots),</span>
<span id="cb137-62"><a href="10-Intro-a-Shiny-exemples.html#cb137-62" tabindex="-1"></a>                <span class="st">&quot;Prix moyen au m2 des appartements, en €&quot;</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">mean</span>(px_m2)),</span>
<span id="cb137-63"><a href="10-Intro-a-Shiny-exemples.html#cb137-63" tabindex="-1"></a>                <span class="st">&quot;Prix médian au m2 des appartements, en €&quot;</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">median</span>(px_m2)),</span>
<span id="cb137-64"><a href="10-Intro-a-Shiny-exemples.html#cb137-64" tabindex="-1"></a>                <span class="st">&quot;Nombre moyen de pièces&quot;</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">mean</span>(nombre_pieces_principales))) <span class="sc">%&gt;%</span> </span>
<span id="cb137-65"><a href="10-Intro-a-Shiny-exemples.html#cb137-65" tabindex="-1"></a>      <span class="fu">gt</span>() <span class="sc">%&gt;%</span>  </span>
<span id="cb137-66"><a href="10-Intro-a-Shiny-exemples.html#cb137-66" tabindex="-1"></a>      <span class="fu">fmt_number</span>(<span class="at">columns=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">sep_mark =</span> <span class="st">&quot; &quot;</span>, <span class="at">decimals =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb137-67"><a href="10-Intro-a-Shiny-exemples.html#cb137-67" tabindex="-1"></a>      <span class="fu">tab_header</span>(<span class="at">title=</span><span class="fu">md</span>(<span class="st">&#39;**Principaux indicateurs sur la période 2019-2022**&#39;</span>))</span>
<span id="cb137-68"><a href="10-Intro-a-Shiny-exemples.html#cb137-68" tabindex="-1"></a>  })</span>
<span id="cb137-69"><a href="10-Intro-a-Shiny-exemples.html#cb137-69" tabindex="-1"></a></span>
<span id="cb137-70"><a href="10-Intro-a-Shiny-exemples.html#cb137-70" tabindex="-1"></a></span>
<span id="cb137-71"><a href="10-Intro-a-Shiny-exemples.html#cb137-71" tabindex="-1"></a>  output<span class="sc">$</span>barplot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb137-72"><a href="10-Intro-a-Shiny-exemples.html#cb137-72" tabindex="-1"></a>  dvf_Paris_1 <span class="sc">%&gt;%</span> </span>
<span id="cb137-73"><a href="10-Intro-a-Shiny-exemples.html#cb137-73" tabindex="-1"></a>      <span class="fu">filter</span>(annee <span class="sc">==</span> input<span class="sc">$</span>annee <span class="sc">&amp;</span> nbpieces_cat<span class="sc">==</span>input<span class="sc">$</span>nb_pieces <span class="sc">&amp;</span> n<span class="sc">==</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb137-74"><a href="10-Intro-a-Shiny-exemples.html#cb137-74" tabindex="-1"></a>      <span class="fu">group_by</span>(nom_arrdt) <span class="sc">%&gt;%</span> </span>
<span id="cb137-75"><a href="10-Intro-a-Shiny-exemples.html#cb137-75" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">med_prixm2 =</span> <span class="fu">round</span>(<span class="fu">median</span>(px_m2))) <span class="sc">%&gt;%</span> </span>
<span id="cb137-76"><a href="10-Intro-a-Shiny-exemples.html#cb137-76" tabindex="-1"></a>      <span class="fu">arrange</span>(<span class="fu">desc</span>(med_prixm2)) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb137-77"><a href="10-Intro-a-Shiny-exemples.html#cb137-77" tabindex="-1"></a>      <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">aes</span>(<span class="at">x =</span> med_prixm2, <span class="at">y =</span> <span class="fu">fct_reorder</span>(nom_arrdt, med_prixm2))  <span class="sc">+</span> </span>
<span id="cb137-78"><a href="10-Intro-a-Shiny-exemples.html#cb137-78" tabindex="-1"></a>      <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="at">fill=</span><span class="st">&quot;darkgoldenrod1&quot;</span>)  <span class="sc">+</span></span>
<span id="cb137-79"><a href="10-Intro-a-Shiny-exemples.html#cb137-79" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label=</span>med_prixm2), <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust=</span><span class="fl">0.5</span>), <span class="at">size=</span><span class="fl">3.8</span>) <span class="sc">+</span></span>
<span id="cb137-80"><a href="10-Intro-a-Shiny-exemples.html#cb137-80" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">&quot;Top 5 des arrondissements ayant les prix médians au m2 des ventes </span><span class="sc">\n</span><span class="st">d&#39;appartements&quot;</span>, </span>
<span id="cb137-81"><a href="10-Intro-a-Shiny-exemples.html#cb137-81" tabindex="-1"></a>                         <span class="fu">ifelse</span>(input<span class="sc">$</span>nb_pieces<span class="sc">==</span><span class="st">&quot;Une pièce&quot;</span>, <span class="st">&quot;d&#39;une pièce&quot;</span>, </span>
<span id="cb137-82"><a href="10-Intro-a-Shiny-exemples.html#cb137-82" tabindex="-1"></a>                              <span class="fu">ifelse</span>(input<span class="sc">$</span>nb_pieces<span class="sc">==</span><span class="st">&quot;Deux pièces&quot;</span>, <span class="st">&quot;de deux pièces&quot;</span>,</span>
<span id="cb137-83"><a href="10-Intro-a-Shiny-exemples.html#cb137-83" tabindex="-1"></a>                                     <span class="fu">ifelse</span>(input<span class="sc">$</span>nb_pieces<span class="sc">==</span><span class="st">&quot;Trois pièces ou plus&quot;</span>, <span class="st">&quot;de trois pièces ou plus&quot;</span>))),</span>
<span id="cb137-84"><a href="10-Intro-a-Shiny-exemples.html#cb137-84" tabindex="-1"></a>                         <span class="st">&quot;les plus élevés en&quot;</span>, input<span class="sc">$</span>annee),</span>
<span id="cb137-85"><a href="10-Intro-a-Shiny-exemples.html#cb137-85" tabindex="-1"></a>           <span class="at">x=</span><span class="st">&quot; &quot;</span>, <span class="at">y=</span><span class="st">&quot; &quot;</span>,</span>
<span id="cb137-86"><a href="10-Intro-a-Shiny-exemples.html#cb137-86" tabindex="-1"></a>           <span class="at">caption =</span> <span class="st">&quot;Source : Base &#39;demande de valeurs foncières&#39;, 2019-2022.&quot;</span>) <span class="sc">+</span></span>
<span id="cb137-87"><a href="10-Intro-a-Shiny-exemples.html#cb137-87" tabindex="-1"></a>      <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb137-88"><a href="10-Intro-a-Shiny-exemples.html#cb137-88" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">17</span>),</span>
<span id="cb137-89"><a href="10-Intro-a-Shiny-exemples.html#cb137-89" tabindex="-1"></a>            <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">size=</span><span class="dv">12</span>),</span>
<span id="cb137-90"><a href="10-Intro-a-Shiny-exemples.html#cb137-90" tabindex="-1"></a>            <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="fl">12.5</span>),</span>
<span id="cb137-91"><a href="10-Intro-a-Shiny-exemples.html#cb137-91" tabindex="-1"></a>            <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="fl">12.5</span>))</span>
<span id="cb137-92"><a href="10-Intro-a-Shiny-exemples.html#cb137-92" tabindex="-1"></a>    </span>
<span id="cb137-93"><a href="10-Intro-a-Shiny-exemples.html#cb137-93" tabindex="-1"></a>  })</span>
<span id="cb137-94"><a href="10-Intro-a-Shiny-exemples.html#cb137-94" tabindex="-1"></a>  </span>
<span id="cb137-95"><a href="10-Intro-a-Shiny-exemples.html#cb137-95" tabindex="-1"></a>}</span>
<span id="cb137-96"><a href="10-Intro-a-Shiny-exemples.html#cb137-96" tabindex="-1"></a></span>
<span id="cb137-97"><a href="10-Intro-a-Shiny-exemples.html#cb137-97" tabindex="-1"></a></span>
<span id="cb137-98"><a href="10-Intro-a-Shiny-exemples.html#cb137-98" tabindex="-1"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span></code></pre></div>
<p>Par rapport aux exemples précédents déjà réalisés sur Shiny, nous n’avons pas beaucoup ajouté de choses nouvelles : un peu de langage html (<code>br()</code>) pour insérer des espaces entre le tableau et le graphique, ou le titre général et le reste des éléments de l’application ; puis une fonction de condition à l’intérieur du <code>labs()</code> de <strong><code>Ggplot</code></strong> et avec la fonction <code>paste()</code> pour, d’une part, que le titre change selon le nombre de pièces choisi par l’utilisateur (plusieurs fonctions <code>ifelse()</code>), et, d’autre part, que le titre change selon l’année choisie).</p>
<p>On va maintenant rendre le tableau réactif selon l’année choisie.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="10-Intro-a-Shiny-exemples.html#cb138-1" tabindex="-1"></a><span class="co"># Définition UI et Server de l&#39;application Shiny</span></span>
<span id="cb138-2"><a href="10-Intro-a-Shiny-exemples.html#cb138-2" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb138-3"><a href="10-Intro-a-Shiny-exemples.html#cb138-3" tabindex="-1"></a>  <span class="co"># Titre de l&#39;application</span></span>
<span id="cb138-4"><a href="10-Intro-a-Shiny-exemples.html#cb138-4" tabindex="-1"></a>  <span class="fu">titlePanel</span>(<span class="st">&quot;Caractéristiques des ventes d&#39;appartements dans Paris sur la période 2019-2022&quot;</span>),</span>
<span id="cb138-5"><a href="10-Intro-a-Shiny-exemples.html#cb138-5" tabindex="-1"></a>  </span>
<span id="cb138-6"><a href="10-Intro-a-Shiny-exemples.html#cb138-6" tabindex="-1"></a>  <span class="fu">br</span>(),</span>
<span id="cb138-7"><a href="10-Intro-a-Shiny-exemples.html#cb138-7" tabindex="-1"></a>  </span>
<span id="cb138-8"><a href="10-Intro-a-Shiny-exemples.html#cb138-8" tabindex="-1"></a>  <span class="co"># Définition du Widget</span></span>
<span id="cb138-9"><a href="10-Intro-a-Shiny-exemples.html#cb138-9" tabindex="-1"></a>  <span class="fu">sidebarLayout</span>(</span>
<span id="cb138-10"><a href="10-Intro-a-Shiny-exemples.html#cb138-10" tabindex="-1"></a>    <span class="fu">sidebarPanel</span>(</span>
<span id="cb138-11"><a href="10-Intro-a-Shiny-exemples.html#cb138-11" tabindex="-1"></a>      <span class="fu">selectInput</span>(<span class="at">inputId =</span> <span class="st">&quot;annee&quot;</span>, </span>
<span id="cb138-12"><a href="10-Intro-a-Shiny-exemples.html#cb138-12" tabindex="-1"></a>                  <span class="at">label =</span> <span class="st">&quot;Choix de l&#39;année de vente pour le tableau et le graphique&quot;</span>, </span>
<span id="cb138-13"><a href="10-Intro-a-Shiny-exemples.html#cb138-13" tabindex="-1"></a>                  <span class="at">choices =</span> <span class="fu">list</span>(<span class="st">&quot;2019&quot;</span>, <span class="st">&quot;2020&quot;</span>, <span class="st">&quot;2021&quot;</span>,<span class="st">&quot;2022&quot;</span>),</span>
<span id="cb138-14"><a href="10-Intro-a-Shiny-exemples.html#cb138-14" tabindex="-1"></a>                  <span class="at">selected =</span> <span class="st">&quot;2019&quot;</span>),</span>
<span id="cb138-15"><a href="10-Intro-a-Shiny-exemples.html#cb138-15" tabindex="-1"></a>      <span class="fu">radioButtons</span>(<span class="at">inputId =</span> <span class="st">&quot;nb_pieces&quot;</span>, </span>
<span id="cb138-16"><a href="10-Intro-a-Shiny-exemples.html#cb138-16" tabindex="-1"></a>                   <span class="at">label =</span> <span class="st">&quot;Choix du nombre de pièces pour le graphique&quot;</span>,</span>
<span id="cb138-17"><a href="10-Intro-a-Shiny-exemples.html#cb138-17" tabindex="-1"></a>                   <span class="at">choices =</span> <span class="fu">levels</span>(dvf_Paris_1<span class="sc">$</span>nbpieces_cat),</span>
<span id="cb138-18"><a href="10-Intro-a-Shiny-exemples.html#cb138-18" tabindex="-1"></a>                   <span class="at">selected =</span> <span class="st">&quot;Deux pièces&quot;</span>)</span>
<span id="cb138-19"><a href="10-Intro-a-Shiny-exemples.html#cb138-19" tabindex="-1"></a></span>
<span id="cb138-20"><a href="10-Intro-a-Shiny-exemples.html#cb138-20" tabindex="-1"></a>      ),</span>
<span id="cb138-21"><a href="10-Intro-a-Shiny-exemples.html#cb138-21" tabindex="-1"></a>    </span>
<span id="cb138-22"><a href="10-Intro-a-Shiny-exemples.html#cb138-22" tabindex="-1"></a>    <span class="co"># Tableau et graphe montré à l&#39;utilisateur</span></span>
<span id="cb138-23"><a href="10-Intro-a-Shiny-exemples.html#cb138-23" tabindex="-1"></a>    <span class="fu">mainPanel</span>(</span>
<span id="cb138-24"><a href="10-Intro-a-Shiny-exemples.html#cb138-24" tabindex="-1"></a>      <span class="fu">gt_output</span>(<span class="st">&quot;tab&quot;</span>),</span>
<span id="cb138-25"><a href="10-Intro-a-Shiny-exemples.html#cb138-25" tabindex="-1"></a></span>
<span id="cb138-26"><a href="10-Intro-a-Shiny-exemples.html#cb138-26" tabindex="-1"></a>      <span class="fu">br</span>(),</span>
<span id="cb138-27"><a href="10-Intro-a-Shiny-exemples.html#cb138-27" tabindex="-1"></a>      <span class="fu">br</span>(),</span>
<span id="cb138-28"><a href="10-Intro-a-Shiny-exemples.html#cb138-28" tabindex="-1"></a>      </span>
<span id="cb138-29"><a href="10-Intro-a-Shiny-exemples.html#cb138-29" tabindex="-1"></a>      <span class="fu">plotOutput</span>(<span class="st">&quot;barplot&quot;</span>)    </span>
<span id="cb138-30"><a href="10-Intro-a-Shiny-exemples.html#cb138-30" tabindex="-1"></a>    )</span>
<span id="cb138-31"><a href="10-Intro-a-Shiny-exemples.html#cb138-31" tabindex="-1"></a>  )</span>
<span id="cb138-32"><a href="10-Intro-a-Shiny-exemples.html#cb138-32" tabindex="-1"></a>)</span>
<span id="cb138-33"><a href="10-Intro-a-Shiny-exemples.html#cb138-33" tabindex="-1"></a></span>
<span id="cb138-34"><a href="10-Intro-a-Shiny-exemples.html#cb138-34" tabindex="-1"></a></span>
<span id="cb138-35"><a href="10-Intro-a-Shiny-exemples.html#cb138-35" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output) {</span>
<span id="cb138-36"><a href="10-Intro-a-Shiny-exemples.html#cb138-36" tabindex="-1"></a></span>
<span id="cb138-37"><a href="10-Intro-a-Shiny-exemples.html#cb138-37" tabindex="-1"></a>  output<span class="sc">$</span>tab <span class="ot">&lt;-</span> <span class="fu">render_gt</span>({</span>
<span id="cb138-38"><a href="10-Intro-a-Shiny-exemples.html#cb138-38" tabindex="-1"></a>    dvf_Paris_1 <span class="sc">%&gt;%</span> </span>
<span id="cb138-39"><a href="10-Intro-a-Shiny-exemples.html#cb138-39" tabindex="-1"></a>      <span class="fu">filter</span>(n<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> annee <span class="sc">==</span> input<span class="sc">$</span>annee) <span class="sc">%&gt;%</span> </span>
<span id="cb138-40"><a href="10-Intro-a-Shiny-exemples.html#cb138-40" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="st">&quot;Nombre de ventes d&#39;appartements&quot;</span> <span class="ot">=</span> <span class="fu">sum</span>(nombre_lots),</span>
<span id="cb138-41"><a href="10-Intro-a-Shiny-exemples.html#cb138-41" tabindex="-1"></a>                <span class="st">&quot;Prix moyen au m2 des appartements, en €&quot;</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">mean</span>(px_m2)),</span>
<span id="cb138-42"><a href="10-Intro-a-Shiny-exemples.html#cb138-42" tabindex="-1"></a>                <span class="st">&quot;Prix médian au m2 des appartements, en €&quot;</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">median</span>(px_m2)),</span>
<span id="cb138-43"><a href="10-Intro-a-Shiny-exemples.html#cb138-43" tabindex="-1"></a>                <span class="st">&quot;Nombre moyen de pièces&quot;</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">mean</span>(nombre_pieces_principales))) <span class="sc">%&gt;%</span> </span>
<span id="cb138-44"><a href="10-Intro-a-Shiny-exemples.html#cb138-44" tabindex="-1"></a>      <span class="fu">gt</span>() <span class="sc">%&gt;%</span>  </span>
<span id="cb138-45"><a href="10-Intro-a-Shiny-exemples.html#cb138-45" tabindex="-1"></a>      <span class="fu">fmt_number</span>(<span class="at">columns=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">sep_mark =</span> <span class="st">&quot; &quot;</span>, <span class="at">decimals =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb138-46"><a href="10-Intro-a-Shiny-exemples.html#cb138-46" tabindex="-1"></a>      <span class="fu">tab_header</span>(<span class="at">title=</span><span class="fu">paste</span>(<span class="st">&#39;Principaux indicateurs en&#39;</span>, input<span class="sc">$</span>annee))</span>
<span id="cb138-47"><a href="10-Intro-a-Shiny-exemples.html#cb138-47" tabindex="-1"></a>  })</span>
<span id="cb138-48"><a href="10-Intro-a-Shiny-exemples.html#cb138-48" tabindex="-1"></a></span>
<span id="cb138-49"><a href="10-Intro-a-Shiny-exemples.html#cb138-49" tabindex="-1"></a></span>
<span id="cb138-50"><a href="10-Intro-a-Shiny-exemples.html#cb138-50" tabindex="-1"></a>  output<span class="sc">$</span>barplot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb138-51"><a href="10-Intro-a-Shiny-exemples.html#cb138-51" tabindex="-1"></a>      dvf_Paris_1 <span class="sc">%&gt;%</span> </span>
<span id="cb138-52"><a href="10-Intro-a-Shiny-exemples.html#cb138-52" tabindex="-1"></a>      <span class="fu">filter</span>(annee <span class="sc">==</span> input<span class="sc">$</span>annee <span class="sc">&amp;</span> nbpieces_cat<span class="sc">==</span>input<span class="sc">$</span>nb_pieces <span class="sc">&amp;</span> n<span class="sc">==</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb138-53"><a href="10-Intro-a-Shiny-exemples.html#cb138-53" tabindex="-1"></a>      <span class="fu">group_by</span>(nom_arrdt) <span class="sc">%&gt;%</span>  </span>
<span id="cb138-54"><a href="10-Intro-a-Shiny-exemples.html#cb138-54" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">med_prixm2 =</span> <span class="fu">round</span>(<span class="fu">median</span>(px_m2))) <span class="sc">%&gt;%</span> </span>
<span id="cb138-55"><a href="10-Intro-a-Shiny-exemples.html#cb138-55" tabindex="-1"></a>      <span class="fu">arrange</span>(<span class="fu">desc</span>(med_prixm2)) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb138-56"><a href="10-Intro-a-Shiny-exemples.html#cb138-56" tabindex="-1"></a>      <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">aes</span>(<span class="at">x =</span> med_prixm2, <span class="at">y =</span> <span class="fu">fct_reorder</span>(nom_arrdt, med_prixm2))  <span class="sc">+</span> </span>
<span id="cb138-57"><a href="10-Intro-a-Shiny-exemples.html#cb138-57" tabindex="-1"></a>      <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="at">fill=</span><span class="st">&quot;darkgoldenrod1&quot;</span>)  <span class="sc">+</span></span>
<span id="cb138-58"><a href="10-Intro-a-Shiny-exemples.html#cb138-58" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label=</span>med_prixm2), <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust=</span><span class="fl">0.5</span>), <span class="at">size=</span><span class="fl">3.8</span>) <span class="sc">+</span></span>
<span id="cb138-59"><a href="10-Intro-a-Shiny-exemples.html#cb138-59" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">&quot;Top 5 des arrondissements ayant les prix médians au m2 des ventes </span><span class="sc">\n</span><span class="st">d&#39;appartements&quot;</span>, </span>
<span id="cb138-60"><a href="10-Intro-a-Shiny-exemples.html#cb138-60" tabindex="-1"></a>                         <span class="fu">ifelse</span>(input<span class="sc">$</span>nb_pieces<span class="sc">==</span><span class="st">&quot;Une pièce&quot;</span>, <span class="st">&quot;d&#39;une pièce&quot;</span>, </span>
<span id="cb138-61"><a href="10-Intro-a-Shiny-exemples.html#cb138-61" tabindex="-1"></a>                              <span class="fu">ifelse</span>(input<span class="sc">$</span>nb_pieces<span class="sc">==</span><span class="st">&quot;Deux pièces&quot;</span>, <span class="st">&quot;de deux pièces&quot;</span>,</span>
<span id="cb138-62"><a href="10-Intro-a-Shiny-exemples.html#cb138-62" tabindex="-1"></a>                                     <span class="fu">ifelse</span>(input<span class="sc">$</span>nb_pieces<span class="sc">==</span><span class="st">&quot;Trois pièces ou plus&quot;</span>, <span class="st">&quot;de trois pièces ou plus&quot;</span>))),</span>
<span id="cb138-63"><a href="10-Intro-a-Shiny-exemples.html#cb138-63" tabindex="-1"></a>                         <span class="st">&quot;les plus élevés en&quot;</span>, input<span class="sc">$</span>annee),</span>
<span id="cb138-64"><a href="10-Intro-a-Shiny-exemples.html#cb138-64" tabindex="-1"></a>           <span class="at">x=</span><span class="st">&quot; &quot;</span>, <span class="at">y=</span><span class="st">&quot; &quot;</span>,</span>
<span id="cb138-65"><a href="10-Intro-a-Shiny-exemples.html#cb138-65" tabindex="-1"></a>           <span class="at">caption =</span> <span class="st">&quot;Source : Base &#39;demande de valeurs foncières&#39;, 2019-2022.&quot;</span>) <span class="sc">+</span></span>
<span id="cb138-66"><a href="10-Intro-a-Shiny-exemples.html#cb138-66" tabindex="-1"></a>      <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb138-67"><a href="10-Intro-a-Shiny-exemples.html#cb138-67" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">17</span>),</span>
<span id="cb138-68"><a href="10-Intro-a-Shiny-exemples.html#cb138-68" tabindex="-1"></a>            <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">size=</span><span class="dv">12</span>),</span>
<span id="cb138-69"><a href="10-Intro-a-Shiny-exemples.html#cb138-69" tabindex="-1"></a>            <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="fl">12.5</span>),</span>
<span id="cb138-70"><a href="10-Intro-a-Shiny-exemples.html#cb138-70" tabindex="-1"></a>            <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="fl">12.5</span>))</span>
<span id="cb138-71"><a href="10-Intro-a-Shiny-exemples.html#cb138-71" tabindex="-1"></a>    </span>
<span id="cb138-72"><a href="10-Intro-a-Shiny-exemples.html#cb138-72" tabindex="-1"></a>  })</span>
<span id="cb138-73"><a href="10-Intro-a-Shiny-exemples.html#cb138-73" tabindex="-1"></a>  </span>
<span id="cb138-74"><a href="10-Intro-a-Shiny-exemples.html#cb138-74" tabindex="-1"></a>}</span>
<span id="cb138-75"><a href="10-Intro-a-Shiny-exemples.html#cb138-75" tabindex="-1"></a></span>
<span id="cb138-76"><a href="10-Intro-a-Shiny-exemples.html#cb138-76" tabindex="-1"></a></span>
<span id="cb138-77"><a href="10-Intro-a-Shiny-exemples.html#cb138-77" tabindex="-1"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span></code></pre></div>
</div>
<div id="introduction-dune-réactivité-appliquée-à-la-table-de-données" class="section level2 hasAnchor" number="11.2">
<h2><span class="header-section-number">11.2</span> Introduction d’une réactivité appliquée à la table de données<a href="10-Intro-a-Shiny-exemples.html#introduction-dune-réactivité-appliquée-à-la-table-de-données" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>On peut rendre maintenant la base de données réactive avec la fonction <code>reactive({})</code>. On l’avait vu, la fonction <code>reactive()</code> permet de créer un objet réactif qui est à la fois une entrée réactive et une sortie réactive, l’objet va donc se mettre à jour automatiquement si les entrées qu’il utilise changent, et il va automatiquement déclencher la mise à jour des sorties où il est utilisé.<br />
La fonction permet techniquement de décomposer du code réactif et est utile lorsque certaines parties du code sont utilisées par plusieurs outputs car elle va permettre alors d’éviter des redondances. Cela peut être le cas lorsqu’on doit filtrer et/ou sélectionner des mêmes variables en input pour plusieurs outputs.<br />
Ici, on va décomposer la partie ‘data’ du code précédent de la partie construction du graphique ; le rendu sera strictement le même ; mais cela peut être plus efficace en cas de long code et d’application complexe car en gros on va exécuter qu’une seule fois l’opération ‘data’ réalisée ici.<br />
Attention, la base réactive créée est une fonction, il faut donc l’appeler avec des parenthèses !</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="10-Intro-a-Shiny-exemples.html#cb139-1" tabindex="-1"></a><span class="co"># Définition UI et Server de l&#39;application Shiny</span></span>
<span id="cb139-2"><a href="10-Intro-a-Shiny-exemples.html#cb139-2" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb139-3"><a href="10-Intro-a-Shiny-exemples.html#cb139-3" tabindex="-1"></a>  <span class="co"># Titre de l&#39;application</span></span>
<span id="cb139-4"><a href="10-Intro-a-Shiny-exemples.html#cb139-4" tabindex="-1"></a>  <span class="fu">titlePanel</span>(<span class="st">&quot;Caractéristiques des ventes d&#39;appartements dans Paris sur la période 2019-2022&quot;</span>),</span>
<span id="cb139-5"><a href="10-Intro-a-Shiny-exemples.html#cb139-5" tabindex="-1"></a>  </span>
<span id="cb139-6"><a href="10-Intro-a-Shiny-exemples.html#cb139-6" tabindex="-1"></a>  <span class="fu">br</span>(),</span>
<span id="cb139-7"><a href="10-Intro-a-Shiny-exemples.html#cb139-7" tabindex="-1"></a>  </span>
<span id="cb139-8"><a href="10-Intro-a-Shiny-exemples.html#cb139-8" tabindex="-1"></a>  <span class="co"># Définition du Widget</span></span>
<span id="cb139-9"><a href="10-Intro-a-Shiny-exemples.html#cb139-9" tabindex="-1"></a>  <span class="fu">sidebarLayout</span>(</span>
<span id="cb139-10"><a href="10-Intro-a-Shiny-exemples.html#cb139-10" tabindex="-1"></a>    <span class="fu">sidebarPanel</span>(</span>
<span id="cb139-11"><a href="10-Intro-a-Shiny-exemples.html#cb139-11" tabindex="-1"></a>      <span class="fu">selectInput</span>(<span class="at">inputId =</span> <span class="st">&quot;annee&quot;</span>, </span>
<span id="cb139-12"><a href="10-Intro-a-Shiny-exemples.html#cb139-12" tabindex="-1"></a>                  <span class="at">label =</span> <span class="st">&quot;Choix de l&#39;année de vente pour le tableau et le graphique&quot;</span>, </span>
<span id="cb139-13"><a href="10-Intro-a-Shiny-exemples.html#cb139-13" tabindex="-1"></a>                  <span class="at">choices =</span> <span class="fu">list</span>(<span class="st">&quot;2019&quot;</span>, <span class="st">&quot;2020&quot;</span>, <span class="st">&quot;2021&quot;</span>,<span class="st">&quot;2022&quot;</span>),</span>
<span id="cb139-14"><a href="10-Intro-a-Shiny-exemples.html#cb139-14" tabindex="-1"></a>                  <span class="at">selected =</span> <span class="st">&quot;2019&quot;</span>),</span>
<span id="cb139-15"><a href="10-Intro-a-Shiny-exemples.html#cb139-15" tabindex="-1"></a>      <span class="fu">radioButtons</span>(<span class="at">inputId =</span> <span class="st">&quot;nb_pieces&quot;</span>, </span>
<span id="cb139-16"><a href="10-Intro-a-Shiny-exemples.html#cb139-16" tabindex="-1"></a>                   <span class="at">label =</span> <span class="st">&quot;Choix du nombre de pièces pour le graphique&quot;</span>,</span>
<span id="cb139-17"><a href="10-Intro-a-Shiny-exemples.html#cb139-17" tabindex="-1"></a>                   <span class="at">choices =</span> <span class="fu">levels</span>(dvf_Paris_1<span class="sc">$</span>nbpieces_cat),</span>
<span id="cb139-18"><a href="10-Intro-a-Shiny-exemples.html#cb139-18" tabindex="-1"></a>                   <span class="at">selected =</span> <span class="st">&quot;Deux pièces&quot;</span>)</span>
<span id="cb139-19"><a href="10-Intro-a-Shiny-exemples.html#cb139-19" tabindex="-1"></a></span>
<span id="cb139-20"><a href="10-Intro-a-Shiny-exemples.html#cb139-20" tabindex="-1"></a>      ),</span>
<span id="cb139-21"><a href="10-Intro-a-Shiny-exemples.html#cb139-21" tabindex="-1"></a>    </span>
<span id="cb139-22"><a href="10-Intro-a-Shiny-exemples.html#cb139-22" tabindex="-1"></a>    <span class="co"># Tableau et graphe montré à l&#39;utilisateur</span></span>
<span id="cb139-23"><a href="10-Intro-a-Shiny-exemples.html#cb139-23" tabindex="-1"></a>    <span class="fu">mainPanel</span>(</span>
<span id="cb139-24"><a href="10-Intro-a-Shiny-exemples.html#cb139-24" tabindex="-1"></a>      <span class="fu">gt_output</span>(<span class="st">&quot;tab&quot;</span>),</span>
<span id="cb139-25"><a href="10-Intro-a-Shiny-exemples.html#cb139-25" tabindex="-1"></a></span>
<span id="cb139-26"><a href="10-Intro-a-Shiny-exemples.html#cb139-26" tabindex="-1"></a>      <span class="fu">br</span>(),</span>
<span id="cb139-27"><a href="10-Intro-a-Shiny-exemples.html#cb139-27" tabindex="-1"></a>      <span class="fu">br</span>(),</span>
<span id="cb139-28"><a href="10-Intro-a-Shiny-exemples.html#cb139-28" tabindex="-1"></a>      </span>
<span id="cb139-29"><a href="10-Intro-a-Shiny-exemples.html#cb139-29" tabindex="-1"></a>      <span class="fu">plotOutput</span>(<span class="st">&quot;barplot&quot;</span>)    </span>
<span id="cb139-30"><a href="10-Intro-a-Shiny-exemples.html#cb139-30" tabindex="-1"></a>    )</span>
<span id="cb139-31"><a href="10-Intro-a-Shiny-exemples.html#cb139-31" tabindex="-1"></a>  )</span>
<span id="cb139-32"><a href="10-Intro-a-Shiny-exemples.html#cb139-32" tabindex="-1"></a>)</span>
<span id="cb139-33"><a href="10-Intro-a-Shiny-exemples.html#cb139-33" tabindex="-1"></a></span>
<span id="cb139-34"><a href="10-Intro-a-Shiny-exemples.html#cb139-34" tabindex="-1"></a></span>
<span id="cb139-35"><a href="10-Intro-a-Shiny-exemples.html#cb139-35" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output) {</span>
<span id="cb139-36"><a href="10-Intro-a-Shiny-exemples.html#cb139-36" tabindex="-1"></a>  </span>
<span id="cb139-37"><a href="10-Intro-a-Shiny-exemples.html#cb139-37" tabindex="-1"></a>  output<span class="sc">$</span>tab <span class="ot">&lt;-</span> <span class="fu">render_gt</span>({</span>
<span id="cb139-38"><a href="10-Intro-a-Shiny-exemples.html#cb139-38" tabindex="-1"></a>    dvf_Paris_1 <span class="sc">%&gt;%</span> </span>
<span id="cb139-39"><a href="10-Intro-a-Shiny-exemples.html#cb139-39" tabindex="-1"></a>      <span class="fu">filter</span>(nombre_lots<span class="sc">==</span><span class="st">&quot;1&quot;</span> <span class="sc">&amp;</span> annee <span class="sc">==</span> input<span class="sc">$</span>annee) <span class="sc">%&gt;%</span> </span>
<span id="cb139-40"><a href="10-Intro-a-Shiny-exemples.html#cb139-40" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="st">&quot;Nombre de ventes d&#39;appartements&quot;</span> <span class="ot">=</span> <span class="fu">sum</span>(nombre_lots),</span>
<span id="cb139-41"><a href="10-Intro-a-Shiny-exemples.html#cb139-41" tabindex="-1"></a>                <span class="st">&quot;Prix moyen au m2 des appartements, en €&quot;</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">mean</span>(px_m2)),</span>
<span id="cb139-42"><a href="10-Intro-a-Shiny-exemples.html#cb139-42" tabindex="-1"></a>                <span class="st">&quot;Prix médian au m2 des appartements, en €&quot;</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">median</span>(px_m2)),</span>
<span id="cb139-43"><a href="10-Intro-a-Shiny-exemples.html#cb139-43" tabindex="-1"></a>                <span class="st">&quot;Nombre moyen de pièces&quot;</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">mean</span>(nombre_pieces_principales))) <span class="sc">%&gt;%</span> </span>
<span id="cb139-44"><a href="10-Intro-a-Shiny-exemples.html#cb139-44" tabindex="-1"></a>      <span class="fu">gt</span>() <span class="sc">%&gt;%</span>  </span>
<span id="cb139-45"><a href="10-Intro-a-Shiny-exemples.html#cb139-45" tabindex="-1"></a>      <span class="fu">fmt_number</span>(<span class="at">columns=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">sep_mark =</span> <span class="st">&quot; &quot;</span>, <span class="at">decimals =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb139-46"><a href="10-Intro-a-Shiny-exemples.html#cb139-46" tabindex="-1"></a>      <span class="fu">tab_header</span>(<span class="at">title=</span><span class="fu">md</span>(<span class="st">&#39;**Principaux indicateurs sur la période 2019-2022**&#39;</span>))</span>
<span id="cb139-47"><a href="10-Intro-a-Shiny-exemples.html#cb139-47" tabindex="-1"></a>  })</span>
<span id="cb139-48"><a href="10-Intro-a-Shiny-exemples.html#cb139-48" tabindex="-1"></a></span>
<span id="cb139-49"><a href="10-Intro-a-Shiny-exemples.html#cb139-49" tabindex="-1"></a>  </span>
<span id="cb139-50"><a href="10-Intro-a-Shiny-exemples.html#cb139-50" tabindex="-1"></a>  dvf_Paris_react <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb139-51"><a href="10-Intro-a-Shiny-exemples.html#cb139-51" tabindex="-1"></a>    dvf_Paris_1 <span class="sc">%&gt;%</span> </span>
<span id="cb139-52"><a href="10-Intro-a-Shiny-exemples.html#cb139-52" tabindex="-1"></a>      <span class="fu">filter</span>(annee <span class="sc">==</span> input<span class="sc">$</span>annee <span class="sc">&amp;</span> nbpieces_cat<span class="sc">==</span>input<span class="sc">$</span>nb_pieces <span class="sc">&amp;</span> annee <span class="sc">==</span> input<span class="sc">$</span>annee) <span class="sc">%&gt;%</span> </span>
<span id="cb139-53"><a href="10-Intro-a-Shiny-exemples.html#cb139-53" tabindex="-1"></a>      <span class="fu">group_by</span>(nom_arrdt) <span class="sc">%&gt;%</span>  </span>
<span id="cb139-54"><a href="10-Intro-a-Shiny-exemples.html#cb139-54" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">med_prixm2 =</span> <span class="fu">round</span>(<span class="fu">median</span>(px_m2))) <span class="sc">%&gt;%</span> </span>
<span id="cb139-55"><a href="10-Intro-a-Shiny-exemples.html#cb139-55" tabindex="-1"></a>      <span class="fu">arrange</span>(<span class="fu">desc</span>(med_prixm2)) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb139-56"><a href="10-Intro-a-Shiny-exemples.html#cb139-56" tabindex="-1"></a>  })</span>
<span id="cb139-57"><a href="10-Intro-a-Shiny-exemples.html#cb139-57" tabindex="-1"></a></span>
<span id="cb139-58"><a href="10-Intro-a-Shiny-exemples.html#cb139-58" tabindex="-1"></a>  output<span class="sc">$</span>barplot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb139-59"><a href="10-Intro-a-Shiny-exemples.html#cb139-59" tabindex="-1"></a>  <span class="fu">dvf_Paris_react</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb139-60"><a href="10-Intro-a-Shiny-exemples.html#cb139-60" tabindex="-1"></a>      <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">aes</span>(<span class="at">x =</span> med_prixm2, <span class="at">y =</span> <span class="fu">fct_reorder</span>(nom_arrdt, med_prixm2))  <span class="sc">+</span> </span>
<span id="cb139-61"><a href="10-Intro-a-Shiny-exemples.html#cb139-61" tabindex="-1"></a>      <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="at">fill=</span><span class="st">&quot;darkgoldenrod1&quot;</span>)  <span class="sc">+</span></span>
<span id="cb139-62"><a href="10-Intro-a-Shiny-exemples.html#cb139-62" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label=</span>med_prixm2), <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust=</span><span class="fl">0.5</span>), <span class="at">size=</span><span class="fl">3.8</span>) <span class="sc">+</span></span>
<span id="cb139-63"><a href="10-Intro-a-Shiny-exemples.html#cb139-63" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">&quot;Top 5 des arrondissements ayant les prix médians au m2 des ventes </span><span class="sc">\n</span><span class="st">d&#39;appartements&quot;</span>, </span>
<span id="cb139-64"><a href="10-Intro-a-Shiny-exemples.html#cb139-64" tabindex="-1"></a>                         <span class="fu">ifelse</span>(input<span class="sc">$</span>nb_pieces<span class="sc">==</span><span class="st">&quot;Une pièce&quot;</span>, <span class="st">&quot;d&#39;une pièce&quot;</span>, </span>
<span id="cb139-65"><a href="10-Intro-a-Shiny-exemples.html#cb139-65" tabindex="-1"></a>                              <span class="fu">ifelse</span>(input<span class="sc">$</span>nb_pieces<span class="sc">==</span><span class="st">&quot;Deux pièces&quot;</span>, <span class="st">&quot;de deux pièces&quot;</span>,</span>
<span id="cb139-66"><a href="10-Intro-a-Shiny-exemples.html#cb139-66" tabindex="-1"></a>                                     <span class="fu">ifelse</span>(input<span class="sc">$</span>nb_pieces<span class="sc">==</span><span class="st">&quot;Trois pièces ou plus&quot;</span>, <span class="st">&quot;de trois pièces ou plus&quot;</span>))),</span>
<span id="cb139-67"><a href="10-Intro-a-Shiny-exemples.html#cb139-67" tabindex="-1"></a>                         <span class="st">&quot;les plus élevés en&quot;</span>, input<span class="sc">$</span>annee),</span>
<span id="cb139-68"><a href="10-Intro-a-Shiny-exemples.html#cb139-68" tabindex="-1"></a>           <span class="at">x=</span><span class="st">&quot; &quot;</span>, <span class="at">y=</span><span class="st">&quot; &quot;</span>,</span>
<span id="cb139-69"><a href="10-Intro-a-Shiny-exemples.html#cb139-69" tabindex="-1"></a>           <span class="at">caption =</span> <span class="st">&quot;Source : Base &#39;demande de valeurs foncières&#39;, 2019-2022.&quot;</span>) <span class="sc">+</span></span>
<span id="cb139-70"><a href="10-Intro-a-Shiny-exemples.html#cb139-70" tabindex="-1"></a>      <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb139-71"><a href="10-Intro-a-Shiny-exemples.html#cb139-71" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">17</span>),</span>
<span id="cb139-72"><a href="10-Intro-a-Shiny-exemples.html#cb139-72" tabindex="-1"></a>            <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">size=</span><span class="dv">12</span>),</span>
<span id="cb139-73"><a href="10-Intro-a-Shiny-exemples.html#cb139-73" tabindex="-1"></a>            <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="fl">12.5</span>),</span>
<span id="cb139-74"><a href="10-Intro-a-Shiny-exemples.html#cb139-74" tabindex="-1"></a>            <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="fl">12.5</span>))</span>
<span id="cb139-75"><a href="10-Intro-a-Shiny-exemples.html#cb139-75" tabindex="-1"></a>    </span>
<span id="cb139-76"><a href="10-Intro-a-Shiny-exemples.html#cb139-76" tabindex="-1"></a>  })</span>
<span id="cb139-77"><a href="10-Intro-a-Shiny-exemples.html#cb139-77" tabindex="-1"></a>  </span>
<span id="cb139-78"><a href="10-Intro-a-Shiny-exemples.html#cb139-78" tabindex="-1"></a>}</span>
<span id="cb139-79"><a href="10-Intro-a-Shiny-exemples.html#cb139-79" tabindex="-1"></a></span>
<span id="cb139-80"><a href="10-Intro-a-Shiny-exemples.html#cb139-80" tabindex="-1"></a></span>
<span id="cb139-81"><a href="10-Intro-a-Shiny-exemples.html#cb139-81" tabindex="-1"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span></code></pre></div>
</div>
<div id="introduction-dune-réactivité-sur-les-inputs-contexte-réactif" class="section level2 hasAnchor" number="11.3">
<h2><span class="header-section-number">11.3</span> Introduction d’une réactivité sur les inputs (contexte réactif)<a href="10-Intro-a-Shiny-exemples.html#introduction-dune-réactivité-sur-les-inputs-contexte-réactif" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>On va maintenant introduire un contexte réactif.<br />
Pour cela, on va repartir de la base du RP, puisqu’on peut y distinguer les départements et les communes, en s’intéressant à la répartition de la population de 15-64 ans selon le type d’activité, et donc par département et commune. On va de façon comparable à ce qu’on a fait précédemment, créer en haut un tableau qui donnera cette répartition pour le département ; puis en-dessous un graphique qui montrera cette répartition pour une des communes de ce département.
On aura donc deux widgets, un pour le choix du département et un pour le choix de la commune. On veut que lorsqu’on choisit Paris en département par exemple, le widget de la commune ne nous montre que les arrondissements de Paris (et non toutes les communes des 4 départements de notre champ), etc.</p>
<p>On peut pour cela utiliser la fonction <code>observe()</code> : on l’utilise donc quand un input change.<br />
Il va falloir ici utiliser à l’intérieur de la fonction <code>observe()</code> une condition <code>if ... else ...</code> : on part du principe qu’on affiche d’abord automatiquement le département “75”, lorsque l’utilisateur appuie sur le bouton du choix de département du widget <code>radioButtons</code>, le widget <code>selectInput</code> doit être actualisé en permettant les seuls choix de communes de Paris donc les arrondissements ; de même pour les autres départements.</p>
<p>Il faut donc utiliser la fonction <code>observe()</code>, une condition <code>if ... else ...</code> et une actualisation des widgets avec la fonction <code>updateSelectInput()</code>.</p>
<p>L’image suivante vous donne un aperçu de ce qu’on devrait avoir pour Paris :
<img src="images/Ex.2_Shiny.png" /></p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="10-Intro-a-Shiny-exemples.html#cb140-1" tabindex="-1"></a><span class="co"># Définition UI et Server de l&#39;application Shiny</span></span>
<span id="cb140-2"><a href="10-Intro-a-Shiny-exemples.html#cb140-2" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb140-3"><a href="10-Intro-a-Shiny-exemples.html#cb140-3" tabindex="-1"></a>  <span class="co"># Titre de l&#39;application</span></span>
<span id="cb140-4"><a href="10-Intro-a-Shiny-exemples.html#cb140-4" tabindex="-1"></a>  <span class="fu">titlePanel</span>(<span class="st">&quot;Type d&#39;activité de la population des 15-64 ans selon le département et la commune dans Paris et sa petite couronne&quot;</span>),</span>
<span id="cb140-5"><a href="10-Intro-a-Shiny-exemples.html#cb140-5" tabindex="-1"></a>  </span>
<span id="cb140-6"><a href="10-Intro-a-Shiny-exemples.html#cb140-6" tabindex="-1"></a>  <span class="co"># Définition du Widget</span></span>
<span id="cb140-7"><a href="10-Intro-a-Shiny-exemples.html#cb140-7" tabindex="-1"></a>  <span class="fu">sidebarLayout</span>(</span>
<span id="cb140-8"><a href="10-Intro-a-Shiny-exemples.html#cb140-8" tabindex="-1"></a>    <span class="fu">sidebarPanel</span>(</span>
<span id="cb140-9"><a href="10-Intro-a-Shiny-exemples.html#cb140-9" tabindex="-1"></a>      <span class="fu">radioButtons</span>(<span class="at">inputId =</span> <span class="st">&quot;dept&quot;</span>, </span>
<span id="cb140-10"><a href="10-Intro-a-Shiny-exemples.html#cb140-10" tabindex="-1"></a>                   <span class="at">label =</span> <span class="st">&quot;Choix du département pour le tableau et le graphique&quot;</span>,</span>
<span id="cb140-11"><a href="10-Intro-a-Shiny-exemples.html#cb140-11" tabindex="-1"></a>                   <span class="at">choices =</span> <span class="fu">unique</span>(RP_final<span class="sc">$</span>DEPT),</span>
<span id="cb140-12"><a href="10-Intro-a-Shiny-exemples.html#cb140-12" tabindex="-1"></a>                   <span class="at">selected =</span> <span class="st">&quot;75&quot;</span>),</span>
<span id="cb140-13"><a href="10-Intro-a-Shiny-exemples.html#cb140-13" tabindex="-1"></a>      <span class="fu">selectInput</span>(<span class="at">inputId =</span> <span class="st">&quot;commune&quot;</span>, </span>
<span id="cb140-14"><a href="10-Intro-a-Shiny-exemples.html#cb140-14" tabindex="-1"></a>                  <span class="at">label =</span> <span class="st">&quot;Choix de la commune pour le graphique&quot;</span>, </span>
<span id="cb140-15"><a href="10-Intro-a-Shiny-exemples.html#cb140-15" tabindex="-1"></a>                  <span class="at">choices =</span> <span class="fu">unique</span>(RP_final<span class="sc">$</span>COM),</span>
<span id="cb140-16"><a href="10-Intro-a-Shiny-exemples.html#cb140-16" tabindex="-1"></a>                  <span class="at">selected =</span> <span class="st">&quot;75112&quot;</span>)</span>
<span id="cb140-17"><a href="10-Intro-a-Shiny-exemples.html#cb140-17" tabindex="-1"></a>      ),</span>
<span id="cb140-18"><a href="10-Intro-a-Shiny-exemples.html#cb140-18" tabindex="-1"></a>    </span>
<span id="cb140-19"><a href="10-Intro-a-Shiny-exemples.html#cb140-19" tabindex="-1"></a>    <span class="co"># Tableau et graphe montré à l&#39;utilisateur</span></span>
<span id="cb140-20"><a href="10-Intro-a-Shiny-exemples.html#cb140-20" tabindex="-1"></a>    <span class="fu">mainPanel</span>(</span>
<span id="cb140-21"><a href="10-Intro-a-Shiny-exemples.html#cb140-21" tabindex="-1"></a>      <span class="fu">gt_output</span>(<span class="st">&quot;tab&quot;</span>),</span>
<span id="cb140-22"><a href="10-Intro-a-Shiny-exemples.html#cb140-22" tabindex="-1"></a>      </span>
<span id="cb140-23"><a href="10-Intro-a-Shiny-exemples.html#cb140-23" tabindex="-1"></a>      <span class="fu">br</span>(),</span>
<span id="cb140-24"><a href="10-Intro-a-Shiny-exemples.html#cb140-24" tabindex="-1"></a>      </span>
<span id="cb140-25"><a href="10-Intro-a-Shiny-exemples.html#cb140-25" tabindex="-1"></a>      <span class="fu">plotOutput</span>(<span class="st">&quot;barplot&quot;</span>)    </span>
<span id="cb140-26"><a href="10-Intro-a-Shiny-exemples.html#cb140-26" tabindex="-1"></a>    )</span>
<span id="cb140-27"><a href="10-Intro-a-Shiny-exemples.html#cb140-27" tabindex="-1"></a>  )</span>
<span id="cb140-28"><a href="10-Intro-a-Shiny-exemples.html#cb140-28" tabindex="-1"></a>)</span>
<span id="cb140-29"><a href="10-Intro-a-Shiny-exemples.html#cb140-29" tabindex="-1"></a></span>
<span id="cb140-30"><a href="10-Intro-a-Shiny-exemples.html#cb140-30" tabindex="-1"></a></span>
<span id="cb140-31"><a href="10-Intro-a-Shiny-exemples.html#cb140-31" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output) {</span>
<span id="cb140-32"><a href="10-Intro-a-Shiny-exemples.html#cb140-32" tabindex="-1"></a>  </span>
<span id="cb140-33"><a href="10-Intro-a-Shiny-exemples.html#cb140-33" tabindex="-1"></a>  RP_final_react <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb140-34"><a href="10-Intro-a-Shiny-exemples.html#cb140-34" tabindex="-1"></a>    RP_final <span class="sc">%&gt;%</span> </span>
<span id="cb140-35"><a href="10-Intro-a-Shiny-exemples.html#cb140-35" tabindex="-1"></a>      <span class="fu">filter</span>(AGEREV<span class="sc">&gt;=</span><span class="dv">15</span> <span class="sc">&amp;</span> AGEREV<span class="sc">&lt;=</span><span class="dv">64</span> <span class="sc">&amp;</span> DEPT<span class="sc">==</span>input<span class="sc">$</span>dept) <span class="sc">%&gt;%</span>  </span>
<span id="cb140-36"><a href="10-Intro-a-Shiny-exemples.html#cb140-36" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">TACT_moda1=</span><span class="fu">as.factor</span>(<span class="fu">case_when</span>(TACT <span class="sc">==</span> <span class="st">&quot;11&quot;</span> <span class="sc">~</span> <span class="st">&quot;Actifs ayant un emploi&quot;</span>,</span>
<span id="cb140-37"><a href="10-Intro-a-Shiny-exemples.html#cb140-37" tabindex="-1"></a>                                            TACT <span class="sc">==</span> <span class="st">&quot;12&quot;</span> <span class="sc">~</span> <span class="st">&quot;Chômeurs&quot;</span>,</span>
<span id="cb140-38"><a href="10-Intro-a-Shiny-exemples.html#cb140-38" tabindex="-1"></a>                                            TACT <span class="sc">==</span> <span class="st">&quot;22&quot;</span> <span class="sc">~</span> <span class="st">&quot;Élèves, étudiants et stagiaires non rémunérés&quot;</span>,</span>
<span id="cb140-39"><a href="10-Intro-a-Shiny-exemples.html#cb140-39" tabindex="-1"></a>                                            TACT <span class="sc">==</span> <span class="st">&quot;21&quot;</span> <span class="sc">~</span> <span class="st">&quot;Retraités ou préretraités&quot;</span>,</span>
<span id="cb140-40"><a href="10-Intro-a-Shiny-exemples.html#cb140-40" tabindex="-1"></a>                                            <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;Autres inactifs&quot;</span>)))</span>
<span id="cb140-41"><a href="10-Intro-a-Shiny-exemples.html#cb140-41" tabindex="-1"></a>  })</span>
<span id="cb140-42"><a href="10-Intro-a-Shiny-exemples.html#cb140-42" tabindex="-1"></a></span>
<span id="cb140-43"><a href="10-Intro-a-Shiny-exemples.html#cb140-43" tabindex="-1"></a>    <span class="fu">observe</span>({</span>
<span id="cb140-44"><a href="10-Intro-a-Shiny-exemples.html#cb140-44" tabindex="-1"></a>    input<span class="sc">$</span>dept</span>
<span id="cb140-45"><a href="10-Intro-a-Shiny-exemples.html#cb140-45" tabindex="-1"></a>    <span class="cf">if</span>(input<span class="sc">$</span>dept <span class="sc">==</span> <span class="st">&quot;75&quot;</span>){</span>
<span id="cb140-46"><a href="10-Intro-a-Shiny-exemples.html#cb140-46" tabindex="-1"></a>      <span class="fu">updateSelectInput</span>(<span class="at">inputId =</span> <span class="st">&quot;commune&quot;</span>,</span>
<span id="cb140-47"><a href="10-Intro-a-Shiny-exemples.html#cb140-47" tabindex="-1"></a>                        <span class="at">choices =</span> <span class="fu">unique</span>(RP_final[RP_final<span class="sc">$</span>DEPT<span class="sc">==</span><span class="st">&quot;75&quot;</span>, ]<span class="sc">$</span>COM),</span>
<span id="cb140-48"><a href="10-Intro-a-Shiny-exemples.html#cb140-48" tabindex="-1"></a>                        <span class="at">selected =</span> <span class="st">&quot;75112&quot;</span>)</span>
<span id="cb140-49"><a href="10-Intro-a-Shiny-exemples.html#cb140-49" tabindex="-1"></a>      }</span>
<span id="cb140-50"><a href="10-Intro-a-Shiny-exemples.html#cb140-50" tabindex="-1"></a>    <span class="cf">else</span> {<span class="fu">updateSelectInput</span>(<span class="at">inputId =</span> <span class="st">&quot;commune&quot;</span>,</span>
<span id="cb140-51"><a href="10-Intro-a-Shiny-exemples.html#cb140-51" tabindex="-1"></a>                            <span class="at">choices =</span> <span class="fu">unique</span>(RP_final[RP_final<span class="sc">$</span>DEPT<span class="sc">==</span>input<span class="sc">$</span>dept, ]<span class="sc">$</span>COM),</span>
<span id="cb140-52"><a href="10-Intro-a-Shiny-exemples.html#cb140-52" tabindex="-1"></a>                            <span class="at">selected =</span> input<span class="sc">$</span>variable)</span>
<span id="cb140-53"><a href="10-Intro-a-Shiny-exemples.html#cb140-53" tabindex="-1"></a>    }</span>
<span id="cb140-54"><a href="10-Intro-a-Shiny-exemples.html#cb140-54" tabindex="-1"></a>  })  </span>
<span id="cb140-55"><a href="10-Intro-a-Shiny-exemples.html#cb140-55" tabindex="-1"></a></span>
<span id="cb140-56"><a href="10-Intro-a-Shiny-exemples.html#cb140-56" tabindex="-1"></a>  output<span class="sc">$</span>tab <span class="ot">&lt;-</span> <span class="fu">render_gt</span>({</span>
<span id="cb140-57"><a href="10-Intro-a-Shiny-exemples.html#cb140-57" tabindex="-1"></a>    <span class="fu">RP_final_react</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb140-58"><a href="10-Intro-a-Shiny-exemples.html#cb140-58" tabindex="-1"></a>      <span class="fu">count</span>(TACT_moda1, <span class="at">wt=</span>IPONDI) <span class="sc">%&gt;%</span> </span>
<span id="cb140-59"><a href="10-Intro-a-Shiny-exemples.html#cb140-59" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">Pourcentage=</span><span class="fu">round</span>(<span class="fu">prop.table</span>(n)<span class="sc">*</span><span class="dv">100</span>,<span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb140-60"><a href="10-Intro-a-Shiny-exemples.html#cb140-60" tabindex="-1"></a>      <span class="fu">arrange</span>(<span class="fu">desc</span>(Pourcentage)) <span class="sc">%&gt;%</span> </span>
<span id="cb140-61"><a href="10-Intro-a-Shiny-exemples.html#cb140-61" tabindex="-1"></a>      <span class="fu">adorn_totals</span>(<span class="st">&quot;row&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb140-62"><a href="10-Intro-a-Shiny-exemples.html#cb140-62" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">Effectif=</span>n, <span class="st">&quot;Type d&#39;activité&quot;</span><span class="ot">=</span>TACT_moda1) <span class="sc">%&gt;%</span> </span>
<span id="cb140-63"><a href="10-Intro-a-Shiny-exemples.html#cb140-63" tabindex="-1"></a>      <span class="fu">gt</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb140-64"><a href="10-Intro-a-Shiny-exemples.html#cb140-64" tabindex="-1"></a>      <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="dv">2</span>, <span class="at">sep_mark =</span> <span class="st">&quot; &quot;</span>, <span class="at">decimals =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb140-65"><a href="10-Intro-a-Shiny-exemples.html#cb140-65" tabindex="-1"></a>      <span class="fu">tab_header</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">&quot;Département affiché :&quot;</span>, input<span class="sc">$</span>dept))</span>
<span id="cb140-66"><a href="10-Intro-a-Shiny-exemples.html#cb140-66" tabindex="-1"></a>  })</span>
<span id="cb140-67"><a href="10-Intro-a-Shiny-exemples.html#cb140-67" tabindex="-1"></a></span>
<span id="cb140-68"><a href="10-Intro-a-Shiny-exemples.html#cb140-68" tabindex="-1"></a></span>
<span id="cb140-69"><a href="10-Intro-a-Shiny-exemples.html#cb140-69" tabindex="-1"></a>  output<span class="sc">$</span>barplot <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb140-70"><a href="10-Intro-a-Shiny-exemples.html#cb140-70" tabindex="-1"></a>    <span class="fu">RP_final_react</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb140-71"><a href="10-Intro-a-Shiny-exemples.html#cb140-71" tabindex="-1"></a>      <span class="fu">filter</span>(COM<span class="sc">==</span>input<span class="sc">$</span>commune) <span class="sc">%&gt;%</span> </span>
<span id="cb140-72"><a href="10-Intro-a-Shiny-exemples.html#cb140-72" tabindex="-1"></a>      <span class="fu">count</span>(TACT_moda1, <span class="at">wt=</span>IPONDI) <span class="sc">%&gt;%</span> </span>
<span id="cb140-73"><a href="10-Intro-a-Shiny-exemples.html#cb140-73" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">Pourcentage=</span><span class="fu">round</span>(<span class="fu">prop.table</span>(n)<span class="sc">*</span><span class="dv">100</span>,<span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb140-74"><a href="10-Intro-a-Shiny-exemples.html#cb140-74" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>n) <span class="sc">%&gt;%</span> </span>
<span id="cb140-75"><a href="10-Intro-a-Shiny-exemples.html#cb140-75" tabindex="-1"></a>      <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">fct_reorder</span>(TACT_moda1, <span class="fu">desc</span>(Pourcentage)), <span class="at">y=</span>Pourcentage) <span class="sc">+</span> </span>
<span id="cb140-76"><a href="10-Intro-a-Shiny-exemples.html#cb140-76" tabindex="-1"></a>      <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">fill=</span><span class="st">&quot;darkgoldenrod1&quot;</span>) <span class="sc">+</span></span>
<span id="cb140-77"><a href="10-Intro-a-Shiny-exemples.html#cb140-77" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label=</span>Pourcentage), <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust=</span><span class="fl">0.5</span>), <span class="at">size=</span><span class="fl">4.7</span>) <span class="sc">+</span></span>
<span id="cb140-78"><a href="10-Intro-a-Shiny-exemples.html#cb140-78" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title=</span><span class="fu">paste</span>(<span class="st">&quot;Répartition de la population en % par type d&#39;activité du&quot;</span>, input<span class="sc">$</span>commune),</span>
<span id="cb140-79"><a href="10-Intro-a-Shiny-exemples.html#cb140-79" tabindex="-1"></a>           <span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot; &quot;</span>) <span class="sc">+</span></span>
<span id="cb140-80"><a href="10-Intro-a-Shiny-exemples.html#cb140-80" tabindex="-1"></a>      <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb140-81"><a href="10-Intro-a-Shiny-exemples.html#cb140-81" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">plot.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">18</span>),</span>
<span id="cb140-82"><a href="10-Intro-a-Shiny-exemples.html#cb140-82" tabindex="-1"></a>            <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>, <span class="at">angle=</span><span class="dv">45</span>, <span class="at">hjust=</span><span class="dv">1</span>))</span>
<span id="cb140-83"><a href="10-Intro-a-Shiny-exemples.html#cb140-83" tabindex="-1"></a>    </span>
<span id="cb140-84"><a href="10-Intro-a-Shiny-exemples.html#cb140-84" tabindex="-1"></a>  })</span>
<span id="cb140-85"><a href="10-Intro-a-Shiny-exemples.html#cb140-85" tabindex="-1"></a>  </span>
<span id="cb140-86"><a href="10-Intro-a-Shiny-exemples.html#cb140-86" tabindex="-1"></a>}</span>
<span id="cb140-87"><a href="10-Intro-a-Shiny-exemples.html#cb140-87" tabindex="-1"></a></span>
<span id="cb140-88"><a href="10-Intro-a-Shiny-exemples.html#cb140-88" tabindex="-1"></a></span>
<span id="cb140-89"><a href="10-Intro-a-Shiny-exemples.html#cb140-89" tabindex="-1"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span></code></pre></div>

</div>
</div>



<script src="js/tidyverse.js"></script>
            </section>

          </div>
        </div>
      </div>
<a href="09-Intro-a-Shiny-theorique.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="11-Clustering-theorique.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"],
"instapper": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/Camille-Sisi/Data-Mining-2024/master/10-Intro-a-Shiny-exemples.Rmd",
"text": "Source"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
